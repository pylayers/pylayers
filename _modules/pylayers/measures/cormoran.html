
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pylayers.measures.cormoran &mdash; Python 1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/sidebar.js"></script>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="top" title="Python 1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" />
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-34943220-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

  </head>
  <body role="document">

    <div class="header-wrapper">
      <div class="header">
          <p class="logo"><a href="../../../index.html">
            <img src="../../../_static/pylayers.png" alt="Logo"/>
          </a>
          </p><div class="navbar">
          <ul>
            <li><a href="../../../download.html">Download</a></li>
            <li><a href="../../../notebook/TOC.html">User Guide</a></li>
            <li><a href="../../../modules/pylayers.html">Reference</a></li>
       </ul>

<div class="search_form">

<div id="cse" style="width: 100%;"></div>
<script>
  (function() {
       var cx = '004820205189002234612:sa15qzuf2ca';
           var gcse = document.createElement('script');
               gcse.type = 'text/javascript';
                   gcse.async = true;
                       gcse.src = (document.location.protocol == 'https:' ?
                           'https:' : 'http:') +
                               '//cse.google.com/cse.js?cx=' + cx;
                                   var s =
                                   document.getElementsByTagName('script')[0];
                                       s.parentNode.insertBefore(gcse, s);
                                         })();
</script>
<gcse:search></gcse:search>
</div>
</div> <!-- end navbar --></div>
    </div>

    <div class="content-wrapper">

      <div class="sphinxsidebar">
	<div class="sphinxsidebarwrapper">
	  <div class="rel">
	   
	<!-- rellinks[1:] is an ugly hack to avoid link to module
	    index  -->
	<div class="rellink">
	<a href="../../../py-modindex.html" title="Python Module Index"
	    >Modules
	    <br>
	    <span class="smallrellink">
	    Python Module...
	    </span>
	    <span class="hiddenrellink">
	    Python Module Index
	    </span>
	    
	    </a>
	</div>
	<!-- Ad a link to the 'up' page -->
	<div class="spacer">
	&nbsp;
	</div>
	<div class="rellink">
	<a href="../../index.html" title="Module code" >
	Up
	<br>
	<span class="smallrellink">
	Module code
	</span>
	<span class="hiddenrellink">
	Module code
	</span>
	
	</a>
	</div>
    </div>
    <p style="text-align: center; background-color: #BFFFFF">This documentation is

    for Python <strong>version 1</strong>
    &mdash; <a href="https://github.com/pylayers/pylayers/archive/master.zip">Other versions</a></p>
    
    <h3>Citing</h3>
    <p>If you use the software, please consider
    <a href="../../../about.html#citing-pylayers">citing pylayers</a>.</p>
    <h3>This page</h3>
	
    
    </div>
	  </div>


      <div class="content">
            
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for pylayers.measures.cormoran</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding:Utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="sd">This module handles CORMORAN measurement data</span>

<span class="sd">CorSer Class</span>
<span class="sd">============</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    cor_log</span>

<span class="sd">CorSer init and load data</span>
<span class="sd">-------------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    CorSer.__init__</span>
<span class="sd">    CorSer.__repr__</span>
<span class="sd">    CorSer._loadBS</span>
<span class="sd">    CorSer._loadTCR</span>
<span class="sd">    CorSer._load_offset_dict</span>
<span class="sd">    CorSer._loadbody</span>
<span class="sd">    CorSer._loadcam</span>
<span class="sd">    CorSer._loadhkb</span>
<span class="sd">    CorSer._loadinfranodes</span>
<span class="sd">    CorSer.loadlog</span>


<span class="sd">CorSer exploit data</span>
<span class="sd">-------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    CorSer.getdevp</span>
<span class="sd">    CorSer.getlink</span>
<span class="sd">    CorSer.getlinkd</span>
<span class="sd">    CorSer.getlinkp</span>
<span class="sd">    CorSer.devmapper</span>
<span class="sd">    CorSer.export_csv</span>


<span class="sd">CorSer visualization tools</span>
<span class="sd">--------------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>


<span class="sd">2D  vizualization</span>
<span class="sd">~~~~~~~~~~~~~~~~</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    CorSer.plot</span>
<span class="sd">    CorSer.pltmob</span>
<span class="sd">    CorSer.plttcr</span>
<span class="sd">    CorSer.pltvisi</span>
<span class="sd">    CorSer.animhkb</span>
<span class="sd">    CorSer.animhkbAP</span>
<span class="sd">    CorSer.imshow</span>
<span class="sd">    Corser.showlink</span>
<span class="sd">    CorSer.pltgt</span>


<span class="sd">3D vizualization</span>
<span class="sd">~~~~~~~~~~~~~~~~</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    CorSer._show3</span>
<span class="sd">    CorSer._show3i</span>
<span class="sd">    CorSer.imshowvisibility</span>
<span class="sd">    CorSer.imshowvisibility_i</span>
<span class="sd">    CorSer.anim</span>



<span class="sd">Video Vizualization</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    CorSer.snapshot</span>
<span class="sd">    CorSer.snapshots</span>
<span class="sd">    CorSer.vlc</span>


<span class="sd">CorSer Internal processing</span>
<span class="sd">--------------------------</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>


<span class="sd">Time Alignement</span>
<span class="sd">~~~~~~~~~~~~~~~</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>


<span class="sd">    CorSer.align</span>
<span class="sd">    CorSer.offset_setter</span>
<span class="sd">    CorSer.offset_setter_video</span>
<span class="sd">    CorSer._align_on_devdf</span>
<span class="sd">    CorSer._align_devdf_on_hkb</span>
<span class="sd">    CorSer._apply_offset&#39;</span>
<span class="sd">    CorSer._save_data_off_dict</span>
<span class="sd">    CorSer._save_offset_dict</span>

<span class="sd">Data frame transformation</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    CorSer.compute_visibility</span>
<span class="sd">    CorSer._computedevpdf</span>
<span class="sd">    CorSer._computedistdf</span>
<span class="sd">    CorSer._distancematrix</span>
<span class="sd">    CorSer._visiarray</span>


<span class="sd">Vizualizing processing</span>
<span class="sd">~~~~~~~~~~~~~~~~~~~~~~</span>

<span class="sd">.. autosummary::</span>
<span class="sd">    :toctree: generated/</span>

<span class="sd">    CorSer.visidev</span>
<span class="sd">    CorSer.visidev2</span>
<span class="sd">    CorSer.__refreshshow3i</span>

<span class="sd">Notes</span>
<span class="sd">-----</span>

<span class="sd">Useful members</span>

<span class="sd">distdf : distance between radio nodes (122 columns)</span>
<span class="sd">devdf  : device data frame</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="c1">#import mayavi.mlab as mlabc</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">scipy.io</span> <span class="kn">as</span> <span class="nn">io</span>
<span class="kn">from</span> <span class="nn">pylayers.util.project</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.util.pyutil</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.mobility.ban.body</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pylayers.gis.layout</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">pylayers.antprop.antenna</span> <span class="kn">as</span> <span class="nn">antenna</span>

<span class="kn">from</span> <span class="nn">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Slider</span><span class="p">,</span> <span class="n">CheckButtons</span><span class="p">,</span> <span class="n">Button</span><span class="p">,</span> <span class="n">Cursor</span>
<span class="kn">from</span> <span class="nn">pylayers.signal.DF</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">moviepy.editor</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">img_as_ubyte</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="kn">import</span> <span class="nn">pickle</span>

<span class="c1">#Those lines handle incompatibility between mayavi and VTK</span>
<span class="c1">#and redirect noisy warning message into a log file</span>
<span class="c1"># import vtk</span>
<span class="c1"># output=vtk.vtkFileOutputWindow()</span>
<span class="c1"># output.SetFileName(&quot;mayaviwarninglog.tmp&quot;)</span>
<span class="c1"># vtk.vtkOutputWindow().SetInstance(output)</span>


<div class="viewcode-block" id="cor_log"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.cor_log.html#pylayers.measures.cormoran.cor_log">[docs]</a><span class="k">def</span> <span class="nf">cor_log</span><span class="p">(</span><span class="n">short</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; display cormoran measurement campaign logfile</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    short : boolean</span>
<span class="sd">        enable short version</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">    &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">    &gt;&gt;&gt; cor_log(short=True)</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">filelog</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CORMORAN&#39;</span><span class="p">],</span><span class="s1">&#39;RAW&#39;</span><span class="p">,</span><span class="s1">&#39;Doc&#39;</span><span class="p">,</span><span class="s1">&#39;MeasurementLog.csv&#39;</span><span class="p">)</span>
    <span class="n">log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filelog</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">short</span> <span class="p">:</span>
        <span class="n">log</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">log</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>
        <span class="n">log</span><span class="p">[</span><span class="s1">&#39;serie&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;Meas Serie&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">log</span><span class="p">[[</span><span class="s1">&#39;serie&#39;</span><span class="p">,</span><span class="s1">&#39;day&#39;</span><span class="p">,</span><span class="s1">&#39;Subject&#39;</span><span class="p">,</span><span class="s1">&#39;techno&#39;</span><span class="p">,</span><span class="s1">&#39;Short Notes&#39;</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">log</span></div>

<span class="k">def</span> <span class="nf">time2npa</span><span class="p">(</span><span class="n">lt</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; convert pd.datetime.time to numpy array</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    lt : pd.datetime.time</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    ta : numpy array</span>
<span class="sd">        time in seconds</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ta</span> <span class="o">=</span> <span class="p">(</span><span class="n">lt</span><span class="o">.</span><span class="n">microsecond</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">+</span>
    <span class="n">lt</span><span class="o">.</span><span class="n">second</span><span class="o">+</span>
    <span class="n">lt</span><span class="o">.</span><span class="n">minute</span><span class="o">*</span><span class="mi">60</span><span class="o">+</span>
    <span class="n">lt</span><span class="o">.</span><span class="n">hour</span><span class="o">*</span><span class="mi">3600</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">ta</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">CorSer</span><span class="p">(</span><span class="n">PyLayers</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Handle CORMORAN measurement data</span>

<span class="sd">    Hikob data handling from CORMORAN measurement campaign</span>

<span class="sd">    11/06/2014</span>
<span class="sd">        single subject (Bernard and Nicolas)</span>

<span class="sd">    12/06/2014</span>
<span class="sd">        several subject (Jihad, Eric , Nicolas)</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="CorSer.__init__"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.__init__.html#pylayers.measures.cormoran.CorSer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">serie</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CITI&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        serie : int</span>
<span class="sd">        day : int</span>
<span class="sd">        source : string</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        The environment variable CORMORAN is indicating the location of data directory</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">day</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]),</span><span class="s2">&quot;wrong day&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CORMORAN&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">(</span><span class="s1">&#39;Please add a CORMORAN environement variable </span><span class="se">\</span>
<span class="s1">                            pointing to the data&#39;</span><span class="p">)</span>

        <span class="c1"># infos</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serie</span> <span class="o">=</span> <span class="n">serie</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">=</span> <span class="n">day</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadlog</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">serie</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="s1">&#39;Serie &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; has no hkb data and will not be loaded&#39;</span>
        <span class="k">if</span> <span class="n">day</span> <span class="o">==</span><span class="mi">12</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">serie</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">]:</span>
                <span class="k">raise</span>  <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Serie &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="o">+</span> \
                                     <span class="s1">&#39; has no hkb data and will not be loaded&#39;</span><span class="p">)</span>
        <span class="c1">#Measures</span>
        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stcr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">35</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shkb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">35</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sbs</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">35</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mocap</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">25</span><span class="p">,</span><span class="mi">26</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">28</span><span class="p">,</span><span class="mi">29</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">31</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">33</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">35</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mocapinterf</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stcr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shkb</span> <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sbs</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mocap</span> <span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">,</span><span class="mi">18</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mocapinterf</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">21</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">23</span><span class="p">,</span><span class="mi">24</span><span class="p">,]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

        <span class="c1"># HIKOB</span>
        <span class="k">if</span> <span class="n">serie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shkb</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadhkb</span><span class="p">(</span><span class="n">serie</span><span class="o">=</span><span class="n">serie</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">)</span>

        <span class="c1"># IR-UWB  TCR</span>
        <span class="k">if</span> <span class="n">serie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stcr</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadTCR</span><span class="p">(</span><span class="n">serie</span><span class="o">=</span><span class="n">serie</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">)</span>

        <span class="c1"># BeSpoon</span>
        <span class="k">if</span> <span class="n">serie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sbs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadBS</span><span class="p">(</span><span class="n">serie</span><span class="o">=</span><span class="n">serie</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">)</span>

        <span class="c1"># set filename</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">==</span><span class="s1">&#39;FULL&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s1">&#39;Sc&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;_S&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serie</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_R&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">=</span> <span class="s1">&#39;Sc&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span> <span class="o">+</span> <span class="s1">&#39;_S&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serie</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_R&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span>


        <span class="c1">#Layout</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="s1">&#39;MOCAP-small2.ini&#39;</span><span class="p">)</span>


        <span class="c1"># Load Infrastructure Nodes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadinfranodes</span><span class="p">()</span>

        <span class="c1"># Load cameras</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_loadcam</span><span class="p">()</span>
        <span class="c1">#BODY &amp; interferers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;jihad&#39;</span><span class="p">,</span><span class="s1">&#39;Jihad&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
        <span class="c1">#filter typos in  self.subject</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;Jihad&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span> <span class="p">:</span>
            <span class="n">uj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s1">&#39;Jihad&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="n">uj</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;Jihan&#39;</span>

        <span class="k">if</span> <span class="n">serie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mocap</span> <span class="p">:</span>
            <span class="c1"># load bodies from mocap file</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_loadbody</span><span class="p">(</span><span class="n">serie</span><span class="o">=</span><span class="n">serie</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="n">day</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_distancematrix</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_computedevpdf</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">traj</span><span class="o">.</span><span class="n">Lfilename</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">traj</span><span class="o">.</span><span class="n">Lfilename</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>

        <span class="c1"># reference time is tmocap</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">time</span>

        <span class="c1"># load offset dict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_offset_dict</span><span class="p">()</span>

        <span class="c1">########################</span>
        <span class="c1">#realign Radio on mocap</span>
        <span class="c1">########################</span>
        <span class="c1"># 1 - Resample radio time =&gt; mocap time</span>
        <span class="c1"># 2 - (if available) apply offset</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">BS data frame index: &#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_align_on_devdf</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;BS&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;Align on mocap OK...&#39;</span><span class="p">,</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_offset</span><span class="p">(</span><span class="s1">&#39;BS&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;time-offset applied OK&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;WARNING time-offset NOT applied&#39;</span>
                <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;No BS offset not yet set =&gt; use self.offset_setter &#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">TCR data frame index:&#39;</span><span class="p">,</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">_align_on_devdf</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;Align on mocap OK...&#39;</span><span class="p">,</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_apply_offset</span><span class="p">(</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;time-offset applied OK&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;WARNING time-offset NOT applied&#39;</span>
                <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;No TCR offset not yet set =&gt; use self.offset_setter&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">HKB data frame index:&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_align_on_devdf</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
            <span class="k">print</span> <span class="s1">&#39;Align on mocap OK...&#39;</span><span class="p">,</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># self._apply_offset(&#39;HKB&#39;)</span>
                <span class="k">print</span> <span class="s1">&#39;time-offset applied OK&#39;</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;WARNING time-offset NOT applied&#39;</span>
                <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;No HKB offset not yet set =&gt; use self.offset_setter&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Create distance Dataframe...&#39;</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_computedistdf</span><span class="p">()</span>
        <span class="k">print</span> <span class="s1">&#39;OK&#39;</span><span class="p">,</span></div>

<div class="viewcode-block" id="CorSer.__repr__"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.__repr__.html#pylayers.measures.cormoran.CorSer.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">st</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;filename : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;filewear : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filewear</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;filebody : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filebody</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;filemocap : &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filemocap</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Day : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/06/2014&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Serie : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serie</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Scenario : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Run : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Type : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Original Video Id : &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">video</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;Subject(s) : &#39;</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;Body available: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="s1">&#39;B&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>

        <span class="k">try</span> <span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;BeSPoon : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileBS</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;HIKOB : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_filehkb</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span> <span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span><span class="o">+</span><span class="s1">&#39;TCR : &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileTCR</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="s1">&#39;----------------------</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">st</span> <span class="o">=</span> <span class="n">st</span> <span class="o">+</span> <span class="n">k</span> <span class="o">+</span> <span class="s1">&#39; :&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

        <span class="k">return</span><span class="p">(</span><span class="n">st</span><span class="p">)</span></div>


    <span class="c1"># @property</span>
    <span class="c1"># def dev(self):</span>
    <span class="c1">#     &quot;&quot;&quot; display device techno, id , id on body, body owner,...</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
        
    <span class="c1">#     title = &#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;.format(&#39;Name in Dataframe&#39;, &#39;Real Id&#39;, &#39;Body Id&#39;, &#39;Subject&#39;)</span>
    <span class="c1">#     print title + &#39;\n&#39; + &#39;-&#39;*len(title) </span>
    <span class="c1">#     if (&#39;HK&#39; in self.typ) or (&#39;FULL&#39; in self.typ):</span>
    <span class="c1">#         hkbkeys = self.idHKB.keys()</span>
    <span class="c1">#         hkbkeys.sort()</span>
    <span class="c1">#         for d in hkbkeys:</span>
    <span class="c1">#             dev = self.devmapper(self.idHKB[d],&#39;HKB&#39;)</span>
    <span class="c1">#             print &#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;.format(dev[0],dev[1],dev[2],dev[3])</span>
    <span class="c1">#     if (&#39;TCR&#39; in self.typ) or (&#39;FULL&#39; in self.typ):</span>
    <span class="c1">#         tcrkeys = self.idTCR.keys()</span>
    <span class="c1">#         tcrkeys.sort()</span>
    <span class="c1">#         for d in tcrkeys:</span>
    <span class="c1">#             dev = self.devmapper(self.idTCR[d],&#39;TCR&#39;)</span>
    <span class="c1">#             print &#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;.format(dev[0],dev[1],dev[2],dev[3])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dev</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display device techno, id , id on body, body owner,...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Name in Dataframe&#39;</span><span class="p">,</span> <span class="s1">&#39;Real Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Body Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Subject&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># access points HKB</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;BS&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># access points TCR</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>  <span class="p">:</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="s1">&#39;{0:66}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="p">)</span>
        <span class="c1">#device per RAT per body</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="p">:</span>
                <span class="c1">#HKB per body</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">):</span>
                        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="c1">#bespoon</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">):</span>
                        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;BS&#39;</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="c1"># print &#39;{0:66}&#39;.format(&#39;-&#39;*len(title) )</span>
                <span class="c1">#TCR per body</span>
                <span class="k">if</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">):</span>
                        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">print</span> <span class="s1">&#39;{0:66}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">ant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; display device techno, id , id on body, body owner,...</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;Name in Dataframe&#39;</span><span class="p">,</span> <span class="s1">&#39;Real Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Body Id&#39;</span><span class="p">,</span> <span class="s1">&#39;Subject&#39;</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> 
        <span class="c1"># access points HKB</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span> <span class="p">:</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;BS&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">:</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># access points TCR</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">)</span>  <span class="p">:</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">print</span> <span class="s1">&#39;{0:66}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="p">)</span>
        <span class="c1">#device per RAT per body</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="p">:</span>
                <span class="c1">#HKB per body</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>

                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">):</span>
                        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="c1">#bespoon</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
                    <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">):</span>
                        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;BS&#39;</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="c1"># print &#39;{0:66}&#39;.format(&#39;-&#39;*len(title) )</span>
                <span class="c1">#TCR per body</span>
                <span class="k">if</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">):</span>
                        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s1">&#39;{0:21} | {1:7} | {2:8} | {3:10} &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dev</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">dev</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="k">print</span> <span class="s1">&#39;{0:66}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="p">)</span>



<div class="viewcode-block" id="CorSer._loadcam"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._loadcam.html#pylayers.measures.cormoran.CorSer._loadcam">[docs]</a>    <span class="k">def</span> <span class="nf">_loadcam</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load camera position </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        update self.cam</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cam</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">6502.16643961174</span><span class="p">,</span><span class="mf">5440.97951452912</span><span class="p">,</span><span class="mf">2296.44437108561</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">7782.34866625776</span><span class="p">,</span><span class="mf">4998.47624994092</span><span class="p">,</span><span class="mf">2417.5861326688</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">8308.82897665828</span><span class="p">,</span><span class="mf">3618.50516290547</span><span class="p">,</span><span class="mf">2698.07710953287</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">5606.68337709102</span><span class="p">,</span><span class="o">-</span><span class="mf">6354.17891528277</span><span class="p">,</span><span class="mf">2500.27779697402</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">8237.91886515041</span><span class="p">,</span><span class="o">-</span><span class="mf">2332.98639475305</span><span class="p">,</span><span class="mf">4765.31798299242</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">5496.0942989988</span><span class="p">,</span><span class="mf">6216.91946236788</span><span class="p">,</span><span class="mf">2433.30012872688</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">8296.19706598514</span><span class="p">,</span><span class="mf">2430.07325486109</span><span class="p">,</span><span class="mf">4794.01607841197</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">7718.37527064615</span><span class="p">,</span><span class="o">-</span><span class="mf">4644.26760522485</span><span class="p">,</span><span class="mf">2584.75330667172</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">8471.27154730777</span><span class="p">,</span><span class="o">-</span><span class="mf">3043.74550832061</span><span class="p">,</span><span class="mf">2683.45089703377</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">8213.04824602894</span><span class="p">,</span><span class="o">-</span><span class="mf">4034.57371591121</span><span class="p">,</span><span class="mf">2368.54548665579</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">7184.66711497403</span><span class="p">,</span><span class="o">-</span><span class="mf">4950.49444503781</span><span class="p">,</span><span class="mf">2317.68563412347</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">7531.66103727189</span><span class="p">,</span><span class="mf">5279.02353243886</span><span class="p">,</span><span class="mf">2479.36291603544</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">6303.08628709464</span><span class="p">,</span><span class="o">-</span><span class="mf">7057.06193926342</span><span class="p">,</span><span class="mf">2288.84938553817</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">5441.17834354692</span><span class="p">,</span><span class="mf">6637.93014323586</span><span class="p">,</span><span class="mf">2315.15657646861</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">8287.79937470615</span><span class="p">,</span><span class="mf">59.1614281340528</span><span class="p">,</span><span class="mf">4809.14535447027</span><span class="p">]</span>
            <span class="p">])</span><span class="o">*</span><span class="mf">1e-3</span></div>


<div class="viewcode-block" id="CorSer._loadinfranodes"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._loadinfranodes.html#pylayers.measures.cormoran.CorSer._loadinfranodes">[docs]</a>    <span class="k">def</span> <span class="nf">_loadinfranodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load infrastructure nodes</span>


<span class="sd">nico</span>

<span class="sd">                        A4</span>
<span class="sd">                    mpts[6,7,8]</span>
<span class="sd">                        X</span>

<span class="sd">            A3                     A1</span>
<span class="sd">        mpts[9,10,11]        mpts[3,4,5]</span>
<span class="sd">            X                      X</span>

<span class="sd">                        A2</span>
<span class="sd">                    mpts[0,1,2]</span>
<span class="sd">                        X</span>


<span class="sd">        TCR = mpts[0,3,6,9]</span>
<span class="sd">        HKB = mpts[1,2,</span>
<span class="sd">                   4,5,</span>
<span class="sd">                   7,8,</span>
<span class="sd">                   10,11]</span>

<span class="sd">bernard</span>


<span class="sd">                        A3</span>
<span class="sd">                    mpts[3,4,5]</span>
<span class="sd">                        X</span>

<span class="sd">            A2                     A4</span>
<span class="sd">        mpts[6,7,8]        mpts[0,1,2]</span>
<span class="sd">            X                      X</span>

<span class="sd">                        A1</span>
<span class="sd">                    mpts[9,10,11]</span>
<span class="sd">                        X</span>


<span class="sd">        TCR = mpts[0,3,6,9]</span>
<span class="sd">        HKB = mpts[1,2,</span>
<span class="sd">                   4,5,</span>
<span class="sd">                   7,8,</span>
<span class="sd">                   10,11]</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;RAW&#39;</span><span class="p">,</span><span class="s1">&#39;11-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;MOCAP&#39;</span><span class="p">,</span><span class="s1">&#39;scene.c3d&#39;</span><span class="p">)</span>

        <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">load infrastructure node position:&quot;</span><span class="p">,</span>
        <span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">infraname</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">c3d</span><span class="o">.</span><span class="n">ReadC3d</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">pts</span><span class="o">/</span><span class="mf">1000.</span>
        <span class="n">mpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="n">uhkb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">]])</span>
            <span class="n">mphkb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mpts</span><span class="p">[</span><span class="n">uhkb</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;HKB:1&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span> <span class="p">:</span> <span class="n">mphkb</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                          <span class="c1"># &#39;T&#39; : np.eye(3),</span>
                          <span class="s1">&#39;s3off&#39;</span> <span class="p">:</span> <span class="mf">0.</span><span class="p">},</span>

                 <span class="s1">&#39;HKB:2&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span> <span class="p">:</span> <span class="n">mphkb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                          <span class="c1"># &#39;T&#39;: np.array([[-0.44807362,  0.89399666,  0.],</span>
                          <span class="c1">#                [-0.89399666, -0.44807362,  0.],</span>
                          <span class="c1">#                [ 0.,0.,1.        ]]),</span>
                          <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">}</span>      <span class="p">,</span>
                 <span class="s1">&#39;HKB:3&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mphkb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                          <span class="c1"># &#39;T&#39;:array([[-0.59846007, -0.80115264,  0.],</span>
                          <span class="c1">#            [ 0.80115264, -0.59846007,  0.],</span>
                          <span class="c1">#            [ 0.,0.,  1.]]),</span>
                          <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">},</span>
                 <span class="s1">&#39;HKB:4&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mphkb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                          <span class="c1"># &#39;T&#39;:array([[-0.44807362, -0.89399666,  0.],</span>
                          <span class="c1">#            [ 0.89399666, -0.44807362,  0.],</span>
                          <span class="c1">#            [ 0.,0.,  1.]]),</span>
                          <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">}</span>
                 <span class="p">})</span>

        <span class="c1"># TCR:31 is the coordinator which was not captured.</span>
        <span class="c1"># The position has been determined via optimization</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;TCR:32&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mpts</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span>
                                       <span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                                       <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">},</span>
                 <span class="s1">&#39;TCR:24&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mpts</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                           <span class="c1"># &#39;T&#39;: np.array([[-0.44807362,  0.89399666,  0.],</span>
                           <span class="c1">#               [-0.89399666, -0.44807362,  0.],</span>
                           <span class="c1">#               [ 0.,0.,1.        ]]),</span>
                           <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">},</span>
                 <span class="s1">&#39;TCR:27&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mpts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                           <span class="c1"># &#39;T&#39;:array([[-0.59846007, -0.80115264,  0.],</span>
                           <span class="c1">#           [ 0.80115264, -0.59846007,  0.],</span>
                           <span class="c1">#           [ 0.,0.,  1.]]),</span>
                           <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">},</span>
                 <span class="s1">&#39;TCR:28&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="c1"># &#39;T&#39;:array([[-0.44807362, -0.89399666,  0.],</span>
                           <span class="c1">#           [ 0.89399666, -0.44807362,  0.],</span>
                           <span class="c1">#           [ 0.,0.,  1.]]),</span>
                           <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">},</span>
                 <span class="s1">&#39;TCR:31&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">array</span><span class="p">([</span><span class="mf">1.7719</span><span class="p">,</span><span class="o">-</span><span class="mf">3.2655</span><span class="p">,</span><span class="mf">1.74</span><span class="p">]),</span>
                           <span class="c1"># &#39;T&#39;:array([[-0.44807362, -0.89399666,  0.],</span>
                           <span class="c1">#           [ 0.89399666, -0.44807362,  0.],</span>
                           <span class="c1">#           [ 0.,0.,  1.]]),</span>
                           <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">}</span>
                 <span class="p">})</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="c1">#BS idem HKB:1 and HKB:2</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span>  <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;BS:74&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mphkb</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
                          <span class="c1"># &#39;T&#39;:np.eye(3),</span>
                          <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.2</span><span class="p">},</span>
                 <span class="s1">&#39;BS:157&#39;</span><span class="p">:{</span><span class="s1">&#39;p&#39;</span><span class="p">:</span><span class="n">mphkb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
                          <span class="c1"># &#39;T&#39;: np.array([[-0.44807362,  0.89399666,  0.],</span>
                          <span class="c1">#                [-0.89399666, -0.44807362,  0.],</span>
                          <span class="c1">#                [ 0.,0.,1.        ]]),</span>
                          <span class="s1">&#39;s3off&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">0.2</span><span class="p">}</span>      <span class="p">,</span>
                 <span class="p">})</span>

        <span class="c1">#load extra  information from inifile (antenna, rotation matrix,...)</span>

        <span class="n">inifile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;BodyandWear&#39;</span><span class="p">,</span><span class="s1">&#39;AccesPoints.ini&#39;</span><span class="p">)</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
        <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">inifile</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;antname&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">antenna</span><span class="o">.</span><span class="n">Antenna</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;file&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;comment&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="s1">&#39;comment&#39;</span><span class="p">)</span></div>
        <span class="c1"># self.pts= np.empty((12,3))</span>
        <span class="c1"># self.pts[:,0]= -mpts[:,1]</span>
        <span class="c1"># self.pts[:,1]= mpts[:,0]</span>
        <span class="c1"># self.pts[:,2]= mpts[:,2]</span>
        <span class="c1"># return mpts</span>
        <span class="c1"># self.dist = np.sqrt(np.sum((mpts[:,np.newaxis,:]-mpts[np.newaxis,:])**2,axis=2))</span>


<div class="viewcode-block" id="CorSer.loadlog"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.loadlog.html#pylayers.measures.cormoran.CorSer.loadlog">[docs]</a>    <span class="k">def</span> <span class="nf">loadlog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load in self.log the log of the current serie</span>
<span class="sd">            from MeasurementLog.csv</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">filelog</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;RAW&#39;</span><span class="p">,</span><span class="s1">&#39;Doc&#39;</span><span class="p">,</span><span class="s1">&#39;MeasurementLog.csv&#39;</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filelog</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;/06/14&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">log</span><span class="p">[(</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;Meas Serie&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">serie</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">date</span><span class="p">)]</span></div>


<div class="viewcode-block" id="CorSer._loadbody"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._loadbody.html#pylayers.measures.cormoran.CorSer._loadbody">[docs]</a>    <span class="k">def</span> <span class="nf">_loadbody</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">serie</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load body from motion capture file</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        day :</span>
<span class="sd">        serie :</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">day</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">],</span><span class="s2">&quot;wrong day in _loadbody&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;LightBlue&#39;</span><span class="p">,</span><span class="s1">&#39;YellowGreen&#39;</span><span class="p">,</span><span class="s1">&#39;PaleVioletRed&#39;</span><span class="p">,</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;white&#39;</span><span class="p">,</span><span class="s1">&#39;white&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">us</span><span class="p">,</span><span class="n">subject</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">):</span>
            <span class="k">print</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">load &quot;</span><span class="p">,</span><span class="n">subject</span><span class="p">,</span> <span class="s2">&quot; body:&quot;</span><span class="p">,</span>
            <span class="n">seriestr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serie</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filemocap</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;RAW&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;MOCAP&#39;</span><span class="p">,</span><span class="s1">&#39;serie_&#39;</span><span class="o">+</span><span class="n">seriestr</span><span class="o">+</span><span class="s1">&#39;.c3d&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">filemocap</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;RAW&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;MOCAP&#39;</span><span class="p">,</span><span class="s1">&#39;Nav_serie_&#39;</span><span class="o">+</span><span class="n">seriestr</span><span class="o">+</span><span class="s1">&#39;.c3d&#39;</span><span class="p">)</span>

            <span class="c1"># body and wear directory</span>
            <span class="n">baw</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;BodyandWear&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">subject</span> <span class="o">==</span><span class="s1">&#39;Jihad&#39;</span><span class="p">:</span>
                <span class="n">subject</span> <span class="o">=</span><span class="s1">&#39;Jihan&#39;</span>


            <span class="c1">#</span>
            <span class="c1"># Load body cylinder description : &quot;Subject.ini&quot;</span>
            <span class="c1"># Load wearable device description (contains antenna filename) :</span>
            <span class="c1">#</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filebody</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">baw</span><span class="p">,</span> <span class="n">subject</span> <span class="o">+</span> <span class="s1">&#39;.ini&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filewear</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">baw</span><span class="p">,</span><span class="n">subject</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span>  <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014_&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">+</span> <span class="s1">&#39;.ini&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">mocapinterf</span><span class="p">:</span>
                <span class="n">multi_subject</span><span class="o">=</span><span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">multi_subject</span><span class="o">=</span><span class="bp">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">subject</span><span class="p">:</span><span class="n">Body</span><span class="p">(</span><span class="n">_filebody</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filebody</span><span class="p">,</span>
                             <span class="n">_filemocap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filemocap</span><span class="p">,</span><span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span> <span class="n">loop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                             <span class="n">_filewear</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filewear</span><span class="p">,</span>
                             <span class="n">centered</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                             <span class="n">multi_subject_mocap</span><span class="o">=</span><span class="n">multi_subject</span><span class="p">,</span>
                             <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">us</span><span class="p">])})</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">serie</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mocapinterf</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interf</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Anis_Cylindre:&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Benoit_Cylindre:&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Bernard_Cylindre:&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Claude_Cylindre:&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Meriem_Cylindre:&#39;</span><span class="p">]</span>
            <span class="n">intertmp</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">serie</span><span class="o">==</span><span class="mi">13</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;Bernard_Cylindre:&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ui</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="p">):</span>
                <span class="c1">#try:</span>
                <span class="k">print</span> <span class="s2">&quot;load &quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span> <span class="s2">&quot; interfering body:&quot;</span><span class="p">,</span>
                <span class="n">_filemocap</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">getshort</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filemocap</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">i</span><span class="p">:</span><span class="n">Cylinder</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">i</span><span class="p">,</span>
                                          <span class="n">_filemocap</span><span class="o">=</span><span class="n">_filemocap</span><span class="p">,</span>
                                          <span class="n">unit</span> <span class="o">=</span> <span class="s1">&#39;mm&#39;</span><span class="p">,</span>
                                          <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="p">[</span><span class="n">ui</span><span class="p">])})</span>
                <span class="n">intertmp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="c1">#except:</span>
                <span class="c1">#    print &quot;Warning ! load &quot;,i, &quot; FAIL !&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="o">=</span><span class="n">intertmp</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="o">=</span><span class="p">[]</span></div>
        <span class="c1"># if len(self.subject) == 1:</span>
        <span class="c1">#     self.B = self.B[self.subject]</span>


<div class="viewcode-block" id="CorSer._loadTCR"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._loadTCR.html#pylayers.measures.cormoran.CorSer._loadTCR">[docs]</a>    <span class="k">def</span> <span class="nf">_loadTCR</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">serie</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">scenario</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="n">run</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load TCR data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        day :</span>
<span class="sd">        serie :</span>
<span class="sd">        scenario :</span>
<span class="sd">        run :</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1">#</span>
        <span class="c1"># TNET : (NodeId,MAC)</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">TNET</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span>
        <span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
        <span class="mi">7</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span>
        <span class="mi">8</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span>
        <span class="mi">9</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span>
        <span class="mi">10</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span>
        <span class="mi">11</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span>
        <span class="mi">12</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
        <span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span>
        <span class="mi">15</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
        <span class="mi">16</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span>
        <span class="mi">17</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
        <span class="mi">18</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span>
        <span class="mi">19</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span>
        <span class="mi">20</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span>
        <span class="mi">21</span><span class="p">:</span><span class="mi">49</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;Unused&#39;</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span>
                  <span class="s1">&#39;COORD&#39;</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span>
                  <span class="s1">&#39;AP1&#39;</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span>
                  <span class="s1">&#39;AP2&#39;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span>
                  <span class="s1">&#39;AP3&#39;</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span>
                  <span class="s1">&#39;AP4&#39;</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span>
                  <span class="s1">&#39;HeadRight&#39;</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span>
                  <span class="s1">&#39;TorsoTopRight&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span>
                  <span class="s1">&#39;TorsoTopLeft&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                  <span class="s1">&#39;BackCenter&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
                  <span class="s1">&#39;HipRight&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                  <span class="s1">&#39;WristRight&#39;</span><span class="p">:</span><span class="mi">26</span><span class="p">,</span>
                  <span class="s1">&#39;WristLeft&#39;</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span>
                  <span class="s1">&#39;KneeLeft&#39;</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
                  <span class="s1">&#39;AnkleRight&#39;</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span>
                  <span class="s1">&#39;AnkleLeft&#39;</span><span class="p">:</span><span class="mi">37</span><span class="p">}</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="s1">&#39;11-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="s1">&#39;12-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span> <span class="o">=</span><span class="p">{</span> <span class="s1">&#39;COORD&#39;</span><span class="p">:</span><span class="mi">31</span><span class="p">,</span>
                        <span class="s1">&#39;AP1&#39;</span><span class="p">:</span><span class="mi">32</span><span class="p">,</span>
                        <span class="s1">&#39;AP2&#39;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span>
                        <span class="s1">&#39;AP3&#39;</span><span class="p">:</span><span class="mi">27</span><span class="p">,</span>
                        <span class="s1">&#39;AP4&#39;</span><span class="p">:</span><span class="mi">28</span><span class="p">,</span>
                   <span class="s1">&#39;Jihad:TorsoTopRight&#39;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span>
                   <span class="s1">&#39;Jihad:TorsoTopLeft&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                   <span class="s1">&#39;Jihad:BackCenter&#39;</span><span class="p">:</span><span class="mi">33</span><span class="p">,</span>
                   <span class="s1">&#39;Jihad:ShoulderLeft&#39;</span><span class="p">:</span><span class="mi">37</span><span class="p">,</span>
                   <span class="s1">&#39;Nicolas:TorsoTopRight&#39;</span><span class="p">:</span><span class="mi">34</span><span class="p">,</span>
                   <span class="s1">&#39;Nicolas:TorsoTopLeft&#39;</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span>
                   <span class="s1">&#39;Nicolas:BackCenter&#39;</span><span class="p">:</span><span class="mi">48</span><span class="p">,</span>
                   <span class="s1">&#39;Nicolas:ShoulderLeft&#39;</span><span class="p">:</span><span class="mi">36</span><span class="p">,</span>
                   <span class="s1">&#39;Eric:TorsoCenter&#39;</span><span class="p">:</span><span class="mi">30</span><span class="p">,</span>
                   <span class="s1">&#39;Eric:BackCenter&#39;</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span>
                   <span class="s1">&#39;Eric:ShoulderLeft&#39;</span><span class="p">:</span><span class="mi">26</span><span class="p">}</span>

        <span class="c1">#</span>
        <span class="c1"># TCR  : (Name , MAC)</span>
        <span class="c1"># iTCR : (MAC , Name)</span>
        <span class="c1"># dTCR : (NodeId, Name)</span>
        <span class="c1">#</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">=</span><span class="n">k</span>


        <span class="n">dTCRni</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">TNET</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">dTCRni</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">TNET</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span>


        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">serie</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fileTCR</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;_S&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">files</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_fileTCR</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;_s&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">files</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fileTCR</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">=</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Sc&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="s1">&#39;NA&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filesc</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;Sc&#39;</span><span class="o">+</span><span class="n">scenario</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fileTCR</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;R&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">filsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">=</span> <span class="n">scenario</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">)</span>

        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileTCR</span><span class="p">)</span>
        <span class="n">dtTCR</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">tcr</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dTCRni</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">dTCRni</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">!=</span><span class="n">l</span><span class="p">:</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">dtTCR</span><span class="p">[((</span><span class="n">dtTCR</span><span class="p">[</span><span class="s1">&#39;ida&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">k</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">dtTCR</span><span class="p">[</span><span class="s1">&#39;idb&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">l</span><span class="p">))]</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;lqi&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;ida&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;idb&#39;</span><span class="p">]</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">!=-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">d</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">sr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                        <span class="n">tcr</span><span class="p">[</span><span class="n">dTCRni</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">dTCRni</span><span class="p">[</span><span class="n">l</span><span class="p">]]</span><span class="o">=</span> <span class="n">sr</span>


        <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">tcr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ts</span> <span class="o">=</span> <span class="mf">75366400.</span><span class="o">/</span><span class="mf">1e9</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">*</span><span class="n">ts</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">t</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ttcr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">index</span></div>

<div class="viewcode-block" id="CorSer._loadBS"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._loadBS.html#pylayers.measures.cormoran.CorSer._loadBS">[docs]</a>    <span class="k">def</span> <span class="nf">_loadBS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">serie</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">scenario</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="n">run</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load BeSpoon data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        day : int</span>
<span class="sd">        serie : string</span>
<span class="sd">        scenario : string</span>
<span class="sd">        run : int</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dBS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;WristRight&#39;</span><span class="p">:</span><span class="mi">157</span><span class="p">,</span><span class="s1">&#39;AnkleRight&#39;</span><span class="p">:</span><span class="mi">74</span><span class="p">,</span><span class="s1">&#39;HandRight&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
        <span class="k">elif</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dBS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;AP1&#39;</span><span class="p">:</span><span class="mi">157</span><span class="p">,</span><span class="s1">&#39;AP2&#39;</span><span class="p">:</span><span class="mi">74</span><span class="p">,</span><span class="s1">&#39;HandRight&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idBS</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dBS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idBS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dBS</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">=</span><span class="n">k</span>

        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="s1">&#39;11-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;BeSpoon&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="s1">&#39;12-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;BeSpoon&#39;</span><span class="p">)</span>

        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">serie</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fileBS</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;S&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">files</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filesc</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;Sc&#39;</span><span class="o">+</span><span class="n">scenario</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">files</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_fileBS</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;R&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">filsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">bespo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_fileBS</span><span class="p">),</span><span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;ts&#39;</span><span class="p">)</span>


        <span class="n">gb</span> <span class="o">=</span> <span class="n">bespo</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;Sensor&#39;</span><span class="p">])</span>
        <span class="c1">#get device id</span>
        <span class="n">devid</span><span class="p">,</span><span class="n">idevid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">bespo</span><span class="p">[</span><span class="s1">&#39;Sensor&#39;</span><span class="p">],</span><span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1"># get index of each group</span>
        <span class="n">dgb</span><span class="o">=</span><span class="p">{</span><span class="n">d</span><span class="p">:</span><span class="n">gb</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devid</span><span class="p">}</span>
        <span class="n">lgb</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dgb</span><span class="p">:</span>
            <span class="n">ind</span> <span class="o">=</span> <span class="n">dgb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">/</span><span class="mf">1e3</span>
            <span class="n">dti</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ind</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
            <span class="n">npai</span> <span class="o">=</span> <span class="n">time2npa</span><span class="p">(</span><span class="n">dti</span><span class="p">)</span>
            <span class="n">npai</span> <span class="o">=</span> <span class="n">npai</span> <span class="o">-</span> <span class="n">npai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dgb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">npai</span><span class="p">)</span>
            <span class="n">lgb</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dgb</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;d&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">idBS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">idBS</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span><span class="n">index</span><span class="o">=</span><span class="n">dgb</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">lgb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lgb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span> <span class="o">=</span> <span class="n">df</span></div>


        <span class="c1">#self.s157 = self.bespo[self.bespo[&#39;Sensor&#39;]==157]</span>
        <span class="c1">#self.s157.set_index(self.s157[&#39;tu&#39;].values/1e9)</span>
        <span class="c1">#self.s74  = self.bespo[self.bespo[&#39;Sensor&#39;]==74]</span>
        <span class="c1">#self.s74.set_index(self.s74[&#39;tu&#39;].values/1e9)</span>
        <span class="c1">#t157 = np.array(self.s157[&#39;tu&#39;]/(1e9))</span>
        <span class="c1">#self.t157 = t157-t157[0]</span>
        <span class="c1">#t74 = np.array(self.s74[&#39;tu&#39;]/(1e9))</span>
        <span class="c1">#self.t74 = t74 - t74[0]</span>


<div class="viewcode-block" id="CorSer._loadhkb"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._loadhkb.html#pylayers.measures.cormoran.CorSer._loadhkb">[docs]</a>    <span class="k">def</span> <span class="nf">_loadhkb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">day</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span><span class="n">serie</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">scenario</span><span class="o">=</span><span class="s1">&#39;20&#39;</span><span class="p">,</span><span class="n">run</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">source</span><span class="o">=</span><span class="s1">&#39;CITI&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load hkb measurement data</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        day : string</span>
<span class="sd">        serie : string</span>
<span class="sd">        scenario : string</span>
<span class="sd">        run : int</span>
<span class="sd">        source : &#39;string&#39;</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        update self.hkb</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">day</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">serie</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;UR1&#39;</span>

        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">11</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span> <span class="o">=</span><span class="p">{</span><span class="s1">&#39;AP1&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;AP2&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;AP3&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;AP4&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span>
                       <span class="s1">&#39;HeadRight&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;TorsoTopRight&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;TorsoTopLeft&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;BackCenter&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="s1">&#39;ElbowRight&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s1">&#39;ElbowLeft&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;HipRight&#39;</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="s1">&#39;WristRight&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span><span class="s1">&#39;WristLeft&#39;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span><span class="s1">&#39;KneeLeft&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span><span class="s1">&#39;AnkleRight&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s1">&#39;AnkleLeft&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;UR1&#39;</span> <span class="p">:</span>
                <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="s1">&#39;11-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;HIKOB&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;CITI&#39;</span><span class="p">:</span>
                <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="s1">&#39;11-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;HIKOB&#39;</span><span class="p">,</span><span class="s1">&#39;CITI&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">day</span><span class="o">==</span><span class="mi">12</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;AP1&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;AP2&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;AP3&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;AP4&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span><span class="s1">&#39;Jihad:TorsoTopRight&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;Jihad:TorsoTopLeft&#39;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="s1">&#39;Jihad:BackCenter&#39;</span><span class="p">:</span><span class="mi">11</span><span class="p">,</span><span class="s1">&#39;JihadShoulderLeft&#39;</span><span class="p">:</span><span class="mi">12</span><span class="p">,</span>
             <span class="s1">&#39;Nicolas:TorsoTopRight&#39;</span><span class="p">:</span><span class="mi">6</span><span class="p">,</span><span class="s1">&#39;Nicolas:TorsoTopLeft&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span><span class="s1">&#39;Nicolas:BackCenter&#39;</span><span class="p">:</span><span class="mi">7</span><span class="p">,</span><span class="s1">&#39;Nicolas:ShoulderLeft&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span>
             <span class="s1">&#39;Eric:TooTopRight&#39;</span><span class="p">:</span><span class="mi">15</span><span class="p">,</span><span class="s1">&#39;Eric:TorsoTopLeft&#39;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span><span class="s1">&#39;Eric:BackCenter&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">,</span><span class="s1">&#39;Eric:ShoulderLeft&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">}</span>
            <span class="c1">#if source==&#39;UR1&#39;:</span>
            <span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="s1">&#39;12-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;HIKOB&#39;</span><span class="p">)</span>

        <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">k</span><span class="p">]]</span><span class="o">=</span><span class="n">k</span>

        <span class="k">if</span> <span class="n">serie</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filehkb</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;S&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">serie</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">files</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filehkb</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;UR1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">=</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Sc&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.mat&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">source</span> <span class="o">==</span> <span class="s1">&#39;CITI&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">scenario</span><span class="o">=</span><span class="n">tt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Sc&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">tt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">run</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="s1">&#39;HKBS&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">video</span> <span class="o">=</span> <span class="n">tt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.mat&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">filesc</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;Sc&#39;</span><span class="o">+</span><span class="n">scenario</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">files</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;UR1&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filehkb</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;R&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">filsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filehkb</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="ow">in</span> <span class="n">x</span> <span class="p">,</span><span class="n">filsc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>


        <span class="n">data</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">loadmat</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_filehkb</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="s1">&#39;UR1&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rssi</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;rssi&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thkb</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rssi</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;val&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thkb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rssi</span><span class="p">)[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">25.832e-3</span>

        <span class="k">def</span> <span class="nf">topandas</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thkb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thkb</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">!=</span><span class="n">l</span><span class="p">:</span>
                        <span class="n">col</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
                        <span class="n">rcol</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">rcol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                            <span class="n">rssi</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rssi</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">rssi</span>

        <span class="n">topandas</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="CorSer.compute_visibility"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.compute_visibility.html#pylayers.measures.cormoran.CorSer.compute_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">compute_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">square_mda</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">all_links</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; determine visibility of links for a given techno</span>


<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>

<span class="sd">            techno  string</span>
<span class="sd">                select the given radio technology of the nodes to determine</span>
<span class="sd">                    the visibility matrix</span>

<span class="sd">            square_mda  boolean</span>
<span class="sd">                select ouput format</span>
<span class="sd">                    True : (device x device x timestamp)</span>
<span class="sd">                    False : (link x timestamp)</span>

<span class="sd">            all_links : bool</span>
<span class="sd">                compute all links or just those for which data is available</span>

<span class="sd">            Return</span>
<span class="sd">            ------</span>

<span class="sd">            if square_mda = True</span>

<span class="sd">            intersection : (ndevice x nbdevice x nb_timestamp)</span>
<span class="sd">                matrice of intersection (1 if link is cut 0 otherwise)</span>
<span class="sd">            links : (nbdevice)</span>
<span class="sd">                name of the links</span>


<span class="sd">            if square_mda = False</span>

<span class="sd">            intersection : (nblink x nb_timestamp)</span>
<span class="sd">                matrice of intersection (1 if link is cut 0 otherwise)</span>
<span class="sd">            links : (nblink x2)</span>
<span class="sd">                name of the links</span>

<span class="sd">            Example</span>
<span class="sd">            -------</span>

<span class="sd">            &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">            &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">            &gt;&gt;&gt; C=CorSer(serie=14,day=12)</span>
<span class="sd">            &gt;&gt;&gt; inter,links=C.compute_visibility(techno=&#39;TCR&#39;,square_mda=True)</span>
<span class="sd">            &gt;&gt;&gt; inter.shape</span>
<span class="sd">                (15, 15, 12473)</span>
<span class="sd">            &gt;&gt;&gt;C.imshowvisibility_i(inter,links)</span>


<span class="sd">        &quot;&quot;&quot;</span>



        <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;FULL&#39;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Serie has not data for techno: &#39;</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
            <span class="n">hname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">dnode</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">)</span>
            <span class="n">dnode</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;COORD&#39;</span><span class="p">)</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;TCR:&#39;</span>
        <span class="k">elif</span> <span class="n">techno</span><span class="o">==</span><span class="s1">&#39;HKB&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;HKBS&#39;</span><span class="p">)</span> <span class="ow">or</span>  <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;FULL&#39;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Serie has not data for techno: &#39;</span><span class="o">+</span><span class="n">techno</span><span class="p">)</span>
            <span class="n">hname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">dnode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s1">&#39;HKB:&#39;</span>
        <span class="c1"># get link list</span>
        <span class="k">if</span> <span class="n">all_links</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">itertools</span>
            <span class="n">links</span> <span class="o">=</span><span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">dnode</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">links</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">hname</span><span class="p">]</span>
            <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links</span> <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;COORD&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;COORD&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="c1">#mapping between device name in self.hkb and on body/in self.devdf</span>
        <span class="n">dev_bid</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="n">techno</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dnode</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>

        <span class="n">nb_totaldev</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span>
        <span class="c1"># extract all dev position on body</span>
        <span class="c1"># Mpdev : (3 x (nb devices and nb infra nodes) x nb_timestamp)</span>
        <span class="n">Mpdev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dev_bid</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">/</span><span class="n">nb_totaldev</span><span class="p">))</span>

        <span class="c1"># get all positions</span>
        <span class="k">for</span> <span class="n">ik</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dev_bid</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
                <span class="n">Mpdev</span><span class="p">[:,</span><span class="n">ik</span><span class="p">,:]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">][:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">][[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">T</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">pts</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">Mpdev</span><span class="p">[:,</span><span class="n">ik</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">pts</span>

        <span class="c1"># create A and B from links</span>
        <span class="n">nA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prefix</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dnode</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links</span><span class="p">])</span>
        <span class="n">nB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">prefix</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dnode</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links</span><span class="p">])</span>

        <span class="n">dma</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dev_bid</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dev_bid</span><span class="p">))))</span>
        <span class="n">mnA</span> <span class="o">=</span> <span class="p">[</span><span class="n">dma</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nA</span><span class="p">]</span>
        <span class="n">mnB</span> <span class="o">=</span> <span class="p">[</span><span class="n">dma</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nB</span><span class="p">]</span>

        <span class="n">A</span><span class="o">=</span><span class="n">Mpdev</span><span class="p">[:,</span><span class="n">mnA</span><span class="p">]</span>
        <span class="n">B</span><span class="o">=</span><span class="n">Mpdev</span><span class="p">[:,</span><span class="n">mnB</span><span class="p">]</span>


        <span class="c1"># intersect2D matrix is</span>
        <span class="c1"># d_0: nb links</span>
        <span class="c1">#d_1: (cylinder number) * nb body + 1 * nb  cylinder_object</span>
        <span class="c1"># d_2 : nb frame</span>
        <span class="n">intersect2D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">),</span>
                                <span class="mi">11</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="p">),</span>
                                <span class="n">Mpdev</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="c1"># usub : index axes subject</span>
        <span class="n">usub_start</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">usub_stop</span><span class="o">=</span><span class="mi">0</span>
        <span class="c1"># C-D correspond to bodies segments</span>
        <span class="c1">#C or D : 3 x 11 body segments x time</span>
        <span class="c1"># radius of cylinders are (nb_cylinder x time)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
            <span class="k">print</span> <span class="s1">&#39;processing shadowing from &#39;</span><span class="p">,</span><span class="n">b</span>
            <span class="c1"># if b is a body not a cylinder</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Cylindre&#39;</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
                <span class="n">uta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">sl</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">uhe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">sl</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
                <span class="n">rad</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">sl</span><span class="p">[:,</span><span class="mi">2</span><span class="p">]</span>

                <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[:,</span><span class="n">uta</span><span class="p">,:]</span>
                <span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[:,</span><span class="n">uhe</span><span class="p">,:]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">radius</span><span class="p">,</span><span class="n">rad</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">radius</span> <span class="o">=</span> <span class="n">rad</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">usub_start</span><span class="o">=</span><span class="n">usub_stop</span>
                <span class="n">usub_stop</span><span class="o">=</span><span class="n">usub_stop</span><span class="o">+</span><span class="mi">11</span>
            <span class="k">else</span><span class="p">:</span>

                <span class="n">cyl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                <span class="c1"># top of cylinder</span>
                <span class="n">top</span> <span class="o">=</span> <span class="n">cyl</span><span class="o">.</span><span class="n">d</span><span class="p">[:,</span><span class="n">cyl</span><span class="o">.</span><span class="n">topnode</span><span class="p">,:]</span>
                <span class="c1"># bottom of cylinder =top with z =0</span>
                <span class="n">bottom</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">cyl</span><span class="o">.</span><span class="n">d</span><span class="p">[:,</span><span class="n">cyl</span><span class="o">.</span><span class="n">topnode</span><span class="p">,:])</span>
                <span class="n">bottom</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span><span class="o">=</span><span class="mf">0.02</span>
                <span class="c1">#top 3 x 1 X time</span>
                <span class="n">C</span><span class="o">=</span><span class="n">top</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
                <span class="n">D</span><span class="o">=</span><span class="n">bottom</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span>
                <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">radius</span><span class="p">,</span><span class="n">cyl</span><span class="o">.</span><span class="n">radius</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]))</span>
                <span class="n">usub_start</span><span class="o">=</span><span class="n">usub_stop</span>
                <span class="n">usub_stop</span><span class="o">=</span><span class="n">usub_stop</span><span class="o">+</span><span class="mi">1</span>

            <span class="n">f</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">dmin</span><span class="o">=</span><span class="n">seg</span><span class="o">.</span><span class="n">segdist</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">hard</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="n">intersect2D</span><span class="p">[:,</span><span class="n">usub_start</span><span class="p">:</span><span class="n">usub_stop</span><span class="p">,:]</span><span class="o">=</span><span class="n">g</span>
            <span class="c1"># import ipdb</span>
            <span class="c1"># ipdb.set_trace()</span>
            <span class="c1">#USEFUL Lines for debug</span>
            <span class="c1">#########################</span>

            <span class="c1"># def plt3d(ndev=53,ncyl=0,kl=11499):</span>
            <span class="c1">#     fig=plt.figure()</span>
            <span class="c1">#     ax=fig.add_subplot(111,projection=&#39;3d&#39;)</span>
            <span class="c1">#     if not isinstance(kl,list):</span>
            <span class="c1">#         kl=[kl]</span>

            <span class="c1">#     for ktime in kl:</span>
            <span class="c1">#         ax.plot([A[0,ndev,ktime],B[0,ndev,ktime]],[A[1,ndev,ktime],B[1,ndev,ktime]],[A[2,ndev,ktime],B[2,ndev,ktime]])</span>
            <span class="c1">#         [ax.plot([C[0,k,ktime],D[0,k,ktime]],[C[1,k,ktime],D[1,k,ktime]],[C[2,k,ktime],D[2,k,ktime]],&#39;k&#39;) for k in range(11) ]</span>
            <span class="c1">#         ax.plot([X[0,ndev,ncyl,ktime],Y[0,ndev,ncyl,ktime]],[X[1,ndev,ncyl,ktime],Y[1,ndev,ncyl,ktime]],[X[2,ndev,ncyl,ktime],Y[2,ndev,ncyl,ktime]])</span>
            <span class="c1">#     ax.auto_scale_xyz([-5, 5], [-5, 5], [0, 2])</span>
            <span class="c1">#     plt.show()</span>
            <span class="c1"># import ipdb</span>
            <span class="c1"># ipdb.set_trace()</span>




        <span class="n">uinter1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">intersect2D</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">radius</span><span class="o">-</span><span class="mf">0.01</span><span class="p">)))</span>
        <span class="n">uinter0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">intersect2D</span><span class="o">&gt;</span><span class="p">(</span><span class="n">radius</span><span class="o">-</span><span class="mf">0.01</span><span class="p">)))</span>
        <span class="c1"># intersect2D_=copy.copy(intersect2D)</span>

        <span class="n">intersect2D</span><span class="p">[</span><span class="n">uinter1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">uinter1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">uinter1</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="mi">1</span>
        <span class="n">intersect2D</span><span class="p">[</span><span class="n">uinter0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">uinter0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">uinter0</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span><span class="o">=</span><span class="mi">0</span>
        <span class="c1"># #integrate the effect of all bodies by summing on axis 1</span>
        <span class="n">intersect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">intersect2D</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span>

        <span class="k">if</span> <span class="n">square_mda</span><span class="p">:</span>
            <span class="n">dev</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">links</span><span class="p">)</span>
            <span class="n">ddev</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dev</span><span class="p">))))</span>
            <span class="n">lmap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">ddev</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">ddev</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]),</span><span class="n">links</span><span class="p">))</span>
            <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">dev</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">dev</span><span class="p">),</span><span class="n">intersect</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intersect</span><span class="p">)):</span>
                <span class="n">id1</span> <span class="o">=</span> <span class="n">lmap</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">id2</span> <span class="o">=</span> <span class="n">lmap</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">M</span><span class="p">[</span><span class="n">id1</span><span class="p">,</span><span class="n">id2</span><span class="p">,:]</span><span class="o">=</span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
                <span class="n">M</span><span class="p">[</span><span class="n">id2</span><span class="p">,</span><span class="n">id1</span><span class="p">,:]</span><span class="o">=</span><span class="n">intersect</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
            <span class="n">intersect</span><span class="o">=</span><span class="n">M</span>
            <span class="n">links</span> <span class="o">=</span> <span class="n">dev</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_visilinks</span> <span class="o">=</span> <span class="n">links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_visiintersect</span> <span class="o">=</span> <span class="n">intersect</span>

        <span class="k">return</span> <span class="n">intersect</span><span class="p">,</span><span class="n">links</span></div>

<div class="viewcode-block" id="CorSer.imshowvisibility"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.imshowvisibility.html#pylayers.measures.cormoran.CorSer.imshowvisibility">[docs]</a>    <span class="k">def</span> <span class="nf">imshowvisibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  imshow visibility mda</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        techno : (HKB|TCR)</span>
<span class="sd">        t : float</span>
<span class="sd">            time in second</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; C=CorSer(serie=6,day=12)</span>
<span class="sd">        &gt;&gt;&gt; inter,links=C.compute_visibility(techno=&#39;TCR&#39;,square_mda=True)</span>
<span class="sd">        &gt;&gt;&gt; i,l=C.imshowvisibility_i(inter,links)</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        pylayers.measures.CorSer.compute_visibility()</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;grid&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;fig&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
           <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
           <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;ax&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;_visiintersect&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;Visibility computed only once&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_visibility</span><span class="p">(</span><span class="n">techno</span><span class="o">=</span><span class="n">techno</span><span class="p">)</span>


        <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visilinks</span>
        <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visiintersect</span>



        <span class="n">kt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span> 
        <span class="n">xtickNames</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">links</span><span class="p">)</span>
        <span class="n">ytickNames</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">links</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">xtickNames</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ytickNames</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">ims</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">inter</span><span class="p">[:,:,</span><span class="n">kt</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;grid&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="CorSer._show3i"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._show3i.html#pylayers.measures.cormoran.CorSer._show3i">[docs]</a>    <span class="k">def</span> <span class="nf">_show3i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3 interactive</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fig</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="s1">&#39;Jog&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mf">1.5</span><span class="p">))</span>

        <span class="c1">#set time to -10 is a trick to make appear interferers cylinder</span>
        <span class="c1">#because __refreshshow3i only update the data of the cylinder.</span>
        <span class="c1"># if cylinder is not present in the first _show3, they are not displayed</span>
        <span class="c1"># later.</span>
        <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">time</span>

        <span class="n">fId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time</span><span class="o">&lt;=</span> <span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bodytime&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;returnfig&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tagtraj&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">mayafig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__refreshshow3i</span><span class="p">(</span><span class="n">fId</span><span class="p">)</span>
        <span class="c1"># ax.grid()</span>


        <span class="c1"># matplotlib Widgets </span>

        <span class="n">slax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">])</span>
        <span class="n">slax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">fId</span><span class="p">]),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">sliderx</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">slax</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">),</span>
                        <span class="n">valinit</span><span class="o">=</span><span class="n">fId</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#AAAAAA&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">update_x</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__refreshshow3i</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">slax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">val</span><span class="p">]),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">pplus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>


        <span class="k">def</span> <span class="nf">mminus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>

        <span class="c1">#QUIT by pressing &#39;q&#39;</span>
        <span class="k">def</span> <span class="nf">press</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span>
                <span class="n">mlab</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">mayafig</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s1">&#39;key_press_event&#39;</span><span class="p">,</span> <span class="n">press</span><span class="p">)</span>


        <span class="c1">#-1 frame axes</span>
        <span class="n">axm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">])</span>
        <span class="n">bm</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axm</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">)</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">minus</span><span class="p">)</span>
                <span class="c1">#+1 frame axes</span>
        <span class="n">axp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">])</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axp</span><span class="p">,</span> <span class="s1">&#39;+1&#39;</span><span class="p">)</span>
        <span class="n">bp</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">plus</span><span class="p">)</span>

        <span class="c1">#-10 frames axes</span>
        <span class="n">axmm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">])</span>
        <span class="n">bmm</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axmm</span><span class="p">,</span> <span class="s1">&#39;-10&#39;</span><span class="p">)</span>
        <span class="n">bmm</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">mminus</span><span class="p">)</span>


        <span class="c1">#+10 frames axes</span>
        <span class="n">axpp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">])</span>
        <span class="n">bpp</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axpp</span><span class="p">,</span> <span class="s1">&#39;+10&#39;</span><span class="p">)</span>
        <span class="n">bpp</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">pplus</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">__refreshshow3i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">kt</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show3 update for interactive mode</span>
<span class="sd">            USED in imshowvisibility_i</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span><span class="p">[</span><span class="n">kt</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ib</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">t</span><span class="p">,</span><span class="n">cs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># body</span>
                <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_pta</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_phe</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayapts</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">z</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">,:])</span>
                <span class="c1"># device</span>
                <span class="n">udev</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;uc3d&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">]</span>
                <span class="n">Xd</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_f</span><span class="p">[</span><span class="n">kt</span><span class="p">,</span><span class="n">udev</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayadev</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Xd</span><span class="p">[</span><span class="mi">0</span><span class="p">,:],</span> <span class="n">y</span><span class="o">=</span><span class="n">Xd</span><span class="p">[</span><span class="mi">1</span><span class="p">,:],</span> <span class="n">z</span><span class="o">=</span><span class="n">Xd</span><span class="p">[</span><span class="mi">2</span><span class="p">,:])</span>
                <span class="c1"># name</span>
                <span class="n">uupper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">==</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayaname</span><span class="o">.</span><span class="n">actors</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayaname</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">text3d</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">uupper</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">uupper</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="n">uupper</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                <span class="c1"># s = np.hstack((cylrad,cylrad))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="c1"># cylinder</span>
                <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">bottom</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayapts</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">z</span><span class="o">=</span><span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">])</span>
                <span class="c1"># name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayaname</span><span class="o">.</span><span class="n">actors</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayaname</span> <span class="o">=</span> <span class="n">mlab</span><span class="o">.</span><span class="n">text3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
                <span class="c1">#vdict</span>
                <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">traj</span><span class="p">[[</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">toposFrameId</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_mayavdic</span><span class="o">.</span><span class="n">mlab_source</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">x</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">z</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">top</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">u</span><span class="o">=</span><span class="n">V</span><span class="p">[</span> <span class="mi">0</span><span class="p">],</span><span class="n">v</span><span class="o">=</span><span class="n">V</span><span class="p">[</span> <span class="mi">1</span><span class="p">],</span><span class="n">w</span><span class="o">=</span><span class="n">V</span><span class="p">[</span> <span class="mi">2</span><span class="p">])</span>


<div class="viewcode-block" id="CorSer.imshowvisibility_i"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.imshowvisibility_i.html#pylayers.measures.cormoran.CorSer.imshowvisibility_i">[docs]</a>    <span class="k">def</span> <span class="nf">imshowvisibility_i</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  imshow visibility mda interactive</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        inter : (nb link x nb link x timestamps)</span>
<span class="sd">        links : (nblinks)</span>
<span class="sd">        time : intial time (s)</span>


<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; C=CorSer(serie=6,day=12)</span>
<span class="sd">        &gt;&gt;&gt; inter,links=C.visimda(techno=&#39;TCR&#39;,square_mda=True)</span>
<span class="sd">        &gt;&gt;&gt; i,l=C.imshowvisibility_i(inter,links)</span>

<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c1"># if in_ipynb():</span>
        <span class="c1">#     notebook = False #program launch in ipyhon notebook</span>
        <span class="c1">#     from IPython.html import widgets # Widget definitions</span>
        <span class="c1">#     from IPython.display import display, clear_output# Used to display widgets in the notebook</span>
        <span class="c1"># else :</span>
        <span class="c1">#     notebook = False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;_visiintersect&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">print</span> <span class="s1">&#39;Visibility is computed only once, Please wait</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_visibility</span><span class="p">(</span><span class="n">techno</span><span class="o">=</span><span class="n">techno</span><span class="p">)</span>


        <span class="n">links</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visilinks</span>
        <span class="n">inter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visiintersect</span>


        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>


        <span class="n">time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span>

        <span class="n">fId</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time</span><span class="o">&lt;=</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">vertc</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">10</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">10</span><span class="p">)]</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span><span class="n">vertc</span><span class="p">)</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">poly</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks_position</span><span class="p">(</span><span class="s1">&#39;top&#39;</span><span class="p">)</span> 
        <span class="n">xtickNames</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">links</span><span class="p">)</span>
        <span class="n">ytickNames</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">links</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">xtickNames</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ytickNames</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">ims</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">l</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">inter</span><span class="p">[:,:,</span><span class="n">fId</span><span class="p">],</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="c1">#set time to -10 is a trick to make appear interferers cylinder</span>
        <span class="c1">#because __refreshshow3i only update the data of the cylinder.</span>
        <span class="c1"># if cylinder is not present in the first _show3, they are not displayed</span>
        <span class="c1"># later.</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bodytime&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">]]</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;returnfig&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">True</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tagtraj&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">False</span>
        <span class="n">mayafig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__refreshshow3i</span><span class="p">(</span><span class="n">fId</span><span class="p">)</span>
        <span class="c1"># ax.grid()</span>


        <span class="c1"># matplotlib Widgets </span>
        <span class="n">slax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
        <span class="n">slax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">fId</span><span class="p">]),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
        <span class="n">sliderx</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">slax</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inter</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">valinit</span><span class="o">=</span><span class="n">fId</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#AAAAAA&#39;</span><span class="p">)</span>

        <span class="c1"># else :</span>
        <span class="c1">#     int_range = widgets.IntSliderWidget(min=0,max=inter.shape[-1],step=1,value=fId)</span>
        <span class="c1">#     display(int_range)</span>


        <span class="k">def</span> <span class="nf">update_x</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">valtext</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">l</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">inter</span><span class="p">[:,:,</span><span class="n">value</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__refreshshow3i</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">slax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">val</span><span class="p">]),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     def update_x(name,value):</span>

        <span class="c1">#         clear_output(wait=True)</span>
        <span class="c1">#         display(plt.gcf())</span>
        <span class="c1">#         plt.imshow(inter[:,:,value],interpolation=&#39;nearest&#39;)</span>
        <span class="c1">#         # l.set_data(inter[:,:,value])</span>
        <span class="c1">#         kwargs[&#39;bodytime&#39;]=[self.tmocap[value]]</span>
        <span class="c1">#         self._show3(**kwargs)</span>
        <span class="c1">#         myu.inotshow(&#39;fig1&#39;,width=200,height=200,magnification=1)</span>
        <span class="c1">#         # slax.set_title(&#39;t=&#39;+str(time[val]),loc=&#39;left&#39;)</span>
        <span class="c1">#         # fig.canvas.draw_idle()</span>
        <span class="c1">#     int_range.on_trait_change(update_x, &#39;value&#39;)</span>



        <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="c1"># if not notebook:</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="c1"># if not notebook:</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">pplus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="c1"># if not notebook:</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">mminus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">-</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="c1"># if not notebook:</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>

        <span class="c1"># #QUIT by pressing &#39;q&#39;</span>
        <span class="c1"># def press(event):</span>
        <span class="c1">#     if event.key == &#39;q&#39;:</span>
        <span class="c1">#         mlab.close(mayafig)</span>
        <span class="c1">#         plt.close(fig)</span>
        <span class="c1"># fig.canvas.mpl_connect(&#39;key_press_event&#39;, press)</span>

        <span class="c1"># if not notebook:</span>
        <span class="c1">#-1 frame axes</span>
        <span class="n">axm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">bm</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axm</span><span class="p">,</span> <span class="s1">&#39;-1&#39;</span><span class="p">)</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">minus</span><span class="p">)</span>

        <span class="c1">#+1 frame axes</span>
        <span class="n">axp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">bp</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axp</span><span class="p">,</span> <span class="s1">&#39;+1&#39;</span><span class="p">)</span>
        <span class="n">bp</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">plus</span><span class="p">)</span>

        <span class="c1">#-10 frames axes</span>
        <span class="n">axmm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">bmm</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axmm</span><span class="p">,</span> <span class="s1">&#39;-10&#39;</span><span class="p">)</span>
        <span class="n">bmm</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">mminus</span><span class="p">)</span>

        <span class="c1">#+10 frames axes</span>
        <span class="n">axpp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">bpp</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axpp</span><span class="p">,</span> <span class="s1">&#39;+10&#39;</span><span class="p">)</span>
        <span class="n">bpp</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">pplus</span><span class="p">)</span>



        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>




<div class="viewcode-block" id="CorSer._distancematrix"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._distancematrix.html#pylayers.measures.cormoran.CorSer._distancematrix">[docs]</a>    <span class="k">def</span> <span class="nf">_distancematrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the ditance matrix between the nodes</span>

<span class="sd">            self.dist : (nb frame x nb_node x nb_node)</span>
<span class="sd">            self.dist_nodesmap : list of used nodes (useful to make the association ;) )</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">B</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span>


        <span class="n">bn</span><span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;dev&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]):</span>
                <span class="n">tdev</span><span class="o">=</span><span class="p">[]</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">:</span>
                    <span class="n">bn</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">tdev</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">k</span><span class="p">][</span><span class="s1">&#39;uc3d&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">tdev</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tdev</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">pnb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pnb</span><span class="p">,</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_f</span><span class="p">[:,</span><span class="n">tdev</span><span class="p">,:]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">pnb</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_f</span><span class="p">[:,</span><span class="n">tdev</span><span class="p">,:]</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">uin</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># infrastructure nodes</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="n">uin</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;HKB:1&#39;</span><span class="p">,</span><span class="s1">&#39;HKB:2&#39;</span><span class="p">,</span><span class="s1">&#39;HKB:3&#39;</span><span class="p">,</span><span class="s1">&#39;HKB:4&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="c1"># TCR:31 is the coordinator (1.7719,-3.26)</span>
            <span class="n">uin</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;TCR:32&#39;</span><span class="p">,</span><span class="s1">&#39;TCR:24&#39;</span><span class="p">,</span><span class="s1">&#39;TCR:27&#39;</span><span class="p">,</span><span class="s1">&#39;TCR:28&#39;</span><span class="p">,</span><span class="s1">&#39;TCR:31&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">day</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
                <span class="n">uin</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s1">&#39;BS:74&#39;</span><span class="p">,</span><span class="s1">&#39;BS:157&#39;</span><span class="p">])</span>
        <span class="n">ln</span> <span class="o">=</span> <span class="n">uin</span> <span class="o">+</span> <span class="n">bn</span>
        <span class="n">pin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">uin</span><span class="p">])</span>
        <span class="n">pin2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">pnb</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pin</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">pin2</span><span class="p">[:,:,:]</span> <span class="o">=</span> <span class="n">pin</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pin2</span><span class="p">,</span><span class="n">pnb</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">p</span><span class="p">[:,:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span><span class="o">-</span><span class="n">p</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:,:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span> <span class="o">=</span> <span class="n">ln</span></div>


<div class="viewcode-block" id="CorSer._computedistdf"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._computedistdf.html#pylayers.measures.cormoran.CorSer._computedistdf">[docs]</a>    <span class="k">def</span> <span class="nf">_computedistdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute the distance dataframe from distance matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># HIKOB</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="n">devmap</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;hkb&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;hkb&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">}</span>
            <span class="n">udev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">devmap</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]),</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">devmap</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="n">iudev</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">udev</span><span class="p">])</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">[:,</span><span class="n">udev</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">udev</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]],</span><span class="n">columns</span><span class="o">=</span><span class="n">iudev</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span><span class="p">)</span>

        <span class="c1"># BE Spoon</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="n">devmap</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;BS&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;BS&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dBS</span><span class="p">}</span>
            <span class="n">udev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">devmap</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]),</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">devmap</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span><span class="o">.</span><span class="n">keys</span><span class="p">()])</span>
            <span class="n">iudev</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">udev</span><span class="p">])</span>
            <span class="n">dfb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">[:,</span><span class="n">udev</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">udev</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]],</span><span class="n">columns</span><span class="o">=</span><span class="n">iudev</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dfb</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">dfb</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
            <span class="n">devmap</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;tcr&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;tcr&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">}</span>
            <span class="n">udev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">devmap</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]),</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">devmap</span><span class="p">[</span><span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])]</span>
                             <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">])</span>
            <span class="c1">#                 for k in self.tcr.keys() if not &#39;COORD&#39; in k])</span>
            <span class="n">iudev</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="p">[</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">udev</span><span class="p">])</span>
            <span class="n">dft</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dist</span><span class="p">[:,</span><span class="n">udev</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">udev</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]],</span><span class="n">columns</span><span class="o">=</span><span class="n">iudev</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">):</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dft</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">dft</span>
            <span class="k">del</span> <span class="n">dft</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">distdf</span><span class="o">=</span><span class="n">df</span></div>

    <span class="c1"># def accessdm(self,a,b,techno=&#39;&#39;):</span>
    <span class="c1">#     &quot;&quot;&quot; access to the distance matrix</span>

    <span class="c1">#         give name|id of node a and b and a given techno. retrun Groung truth</span>
    <span class="c1">#         distance between the 2 nodes</span>
    <span class="c1">#     # &quot;&quot;&quot;</span>

    <span class="c1">#     # a,ia,bia,subja=self.devmapper(a,techno)</span>
    <span class="c1">#     # b,ib,bib,subjb=self.devmapper(b,techno)</span>

    <span class="c1">#     if &#39;HKB&#39; in techno :</span>
    <span class="c1">#         if isinstance(a,str):</span>
    <span class="c1">#             ia = self.dHKB[a]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             ia = a</span>
    <span class="c1">#             a = self.idHKB[a]</span>

    <span class="c1">#         if isinstance(b,str):</span>
    <span class="c1">#             ib = self.dHKB[b]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             ib = b</span>
    <span class="c1">#             b = self.idHKB[b]</span>

    <span class="c1">#     elif &#39;TCR&#39; in techno :</span>
    <span class="c1">#         if isinstance(a,str):</span>
    <span class="c1">#             ia = self.dTCR[a]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             ia = a</span>
    <span class="c1">#             a = self.idTCR[a]</span>

    <span class="c1">#         if isinstance(b,str):</span>
    <span class="c1">#             ib = self.dTCR[b]</span>
    <span class="c1">#         else:</span>
    <span class="c1">#             ib = b</span>
    <span class="c1">#             b = self.idTCR[b]</span>

    <span class="c1">#     else :</span>
    <span class="c1">#         raise AttributeError(&#39;please give only 1 techno or radio node&#39;)</span>

    <span class="c1">#     ka = techno+&#39;:&#39;+str(ia)</span>
    <span class="c1">#     kb = techno+&#39;:&#39;+str(ib)</span>

    <span class="c1">#     ua = self.dist_nodesmap.index(ka)</span>
    <span class="c1">#     ub = self.dist_nodesmap.index(kb)</span>

    <span class="c1">#     return(ua,ub)</span>





        <span class="c1"># c3ds = self.B._f.shape</span>
        <span class="c1"># if &#39;Full&#39; in self.typ:</span>
        <span class="c1">#     pdev= np.empty((c3ds[0],len(self.dHKB)+len(self.tcr)+len(bs),3))</span>
        <span class="c1"># elif &#39;HK&#39; in self.typ:</span>
        <span class="c1">#     pdev= np.empty((c3ds[0],len(self.dHKB)+len(bs),3))</span>
        <span class="c1"># elif &#39;TCR&#39; in self.typ:</span>
        <span class="c1">#     pdev= np.empty((c3ds[0],len(self.tcr),3))</span>
        <span class="c1"># else:</span>
        <span class="c1">#     raise AttributeError(&#39;invalid self.typ&#39;)</span>

        <span class="c1"># self.B.network()</span>
        <span class="c1"># DB = self.B.D2</span>

        <span class="c1"># ludev = np.array([[i,self.B.dev[i][&#39;uc3d&#39;][0]] for i in self.B.dev])</span>
        <span class="c1"># for i in ludev:</span>
        <span class="c1">#     pdev[:,eval(i[0])-1,:] = self.B._f[:,i[1],:]</span>
        <span class="c1"># # self.dist = np.sqrt(np.sum((mpts[:,np.newaxis,:]-mpts[np.newaxis,:])**2,axis=2))</span>


<div class="viewcode-block" id="CorSer.vlc"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.vlc.html#pylayers.measures.cormoran.CorSer.vlc">[docs]</a>    <span class="k">def</span> <span class="nf">vlc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; play video of the associated serie</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">videofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;Videos&#39;</span><span class="p">)</span>
        <span class="n">ldir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">videofile</span><span class="p">)</span>
        <span class="n">luldir</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span><span class="n">ldir</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">uldir</span> <span class="o">=</span> <span class="n">luldir</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">_filename</span> <span class="o">=</span> <span class="n">ldir</span><span class="p">[</span><span class="n">uldir</span><span class="p">]</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">videofile</span><span class="p">,</span><span class="n">_filename</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;vlc &#39;</span><span class="o">+</span><span class="n">filename</span> <span class="o">+</span><span class="s1">&#39;&amp;&#39;</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;file &#39;</span><span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span> <span class="s1">&#39; not found&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CorSer.snapshot"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.snapshot.html#pylayers.measures.cormoran.CorSer.snapshot">[docs]</a>    <span class="k">def</span> <span class="nf">snapshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mf">15.5</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="p">[],</span><span class="n">ax</span><span class="o">=</span><span class="p">[],</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot; single snapshot plot</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        t0: float</span>
<span class="sd">        offset : float</span>
<span class="sd">        title : boolean</span>
<span class="sd">        save : boolean</span>
<span class="sd">        fig</span>
<span class="sd">        ax</span>
<span class="sd">        figsize : tuple</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fig</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;video_sec&#39;</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">][</span><span class="s1">&#39;video_sec&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">offset</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span><span class="o">=</span><span class="mi">0</span>

        <span class="n">videofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;Videos&#39;</span><span class="p">)</span>
        <span class="n">ldir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">videofile</span><span class="p">)</span>
        <span class="n">luldir</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span><span class="n">ldir</span><span class="p">)</span>
        <span class="n">uldir</span> <span class="o">=</span> <span class="n">luldir</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="n">ldir</span><span class="p">[</span><span class="n">uldir</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">videofile</span><span class="p">,</span><span class="n">_filename</span><span class="p">)</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">VideoFileClip</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;t = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_snap.png&#39;</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>


<div class="viewcode-block" id="CorSer.snapshots"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.snapshots.html#pylayers.measures.cormoran.CorSer.snapshots">[docs]</a>    <span class="k">def</span> <span class="nf">snapshots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">t1</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mf">15.5</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; take snapshots </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        t0 : float</span>
<span class="sd">        t1 : float</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">]</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="s1">&#39;video_sec&#39;</span><span class="p">):</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">][</span><span class="s1">&#39;video_sec&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">offset</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">offset</span> <span class="o">=</span> <span class="n">offset</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">offset</span><span class="o">=</span><span class="mi">0</span>


        <span class="n">videofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;Videos&#39;</span><span class="p">)</span>
        <span class="n">ldir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">videofile</span><span class="p">)</span>
        <span class="n">luldir</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span><span class="n">ldir</span><span class="p">)</span>
        <span class="n">uldir</span> <span class="o">=</span> <span class="n">luldir</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="n">ldir</span><span class="p">[</span><span class="n">uldir</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">videofile</span><span class="p">,</span><span class="n">_filename</span><span class="p">)</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">VideoFileClip</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">F1</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">t1</span><span class="o">+</span><span class="n">offset</span><span class="p">)</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
        <span class="n">I1</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">F1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;t = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">F1</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;t = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;s&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="CorSer._show3"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._show3.html#pylayers.measures.cormoran.CorSer._show3">[docs]</a>    <span class="k">def</span> <span class="nf">_show3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; mayavi 3d show of scenario</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        L : boolean</span>
<span class="sd">            display layout (True)</span>

<span class="sd">        body :boolean</span>
<span class="sd">            display bodytime(True)</span>
<span class="sd">        bodyname : boolean</span>
<span class="sd">            display body name</span>
<span class="sd">        bodytime: list</span>
<span class="sd">            list of time instant where body topos has to be shown</span>


<span class="sd">        devsize : float</span>
<span class="sd">            device on body size (100)</span>
<span class="sd">        devlist : list</span>
<span class="sd">            list of device name to show on body</span>
<span class="sd">        pattern : boolean</span>
<span class="sd">            display devices pattern</span>

<span class="sd">        trajectory : boolean</span>
<span class="sd">            display trajectory  (True)</span>
<span class="sd">        tagtraj : boolean</span>
<span class="sd">            tag on trajectory at the &#39;bodytime&#39; instants (True)</span>
<span class="sd">        tagname : list</span>
<span class="sd">            name of the tagtrajs</span>
<span class="sd">        tagpoffset : ndarray</span>
<span class="sd">            offset of the tag positions (nb_of_tags x 3)</span>
<span class="sd">        fontsizetag : float</span>
<span class="sd">            size of the tag names</span>


<span class="sd">        inodes : boolean</span>
<span class="sd">            display infrastructure nodes</span>
<span class="sd">        inname : boolean</span>
<span class="sd">            display infra strucutre node name</span>
<span class="sd">        innamesize : float,</span>
<span class="sd">            size of name of infrastructure nodes (0.1)</span>
<span class="sd">        incolor: str</span>
<span class="sd">            color of infrastructure nodes (&#39;r&#39;)</span>
<span class="sd">        insize</span>
<span class="sd">            size of infrastructure nodes (0.1)</span>


<span class="sd">        camera : boolean</span>
<span class="sd">            display Vicon camera position (True)</span>
<span class="sd">        cameracolor : str</span>
<span class="sd">            color of camera nodes (&#39;b&#39;)</span>
<span class="sd">        camerasize  : float</span>
<span class="sd">            size of camera nodes (0.1)</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            &gt;&gt;&gt; S  = Corser(6)</span>
<span class="sd">            &gt;&gt;&gt; S._show3()</span>



<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;body&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;bodyname&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;subject&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;interf&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;trajectory&#39;</span> <span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;devsize&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>
                     <span class="s1">&#39;devlist&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;pattern&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;inodes&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;inname&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;innamesize&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                     <span class="s1">&#39;incolor&#39;</span> <span class="p">:</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;insize&#39;</span> <span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span>
                     <span class="s1">&#39;camera&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;cameracolor&#39;</span> <span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;camerasize&#39;</span> <span class="p">:</span><span class="mf">0.1</span><span class="p">,</span>
                     <span class="s1">&#39;bodytime&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;tagtraj&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;tagname&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;tagpoffset&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;fontsizetag&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span>
                     <span class="s1">&#39;trajectory_color_range&#39;</span><span class="p">:</span><span class="bp">True</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">cold</span> <span class="o">=</span> <span class="n">pyu</span><span class="o">.</span><span class="n">coldict</span><span class="p">()</span>
        <span class="n">camhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;cameracolor&#39;</span><span class="p">]]</span>
        <span class="n">cam_color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">camhex</span><span class="p">)</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>
        <span class="n">inhex</span> <span class="o">=</span> <span class="n">cold</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;incolor&#39;</span><span class="p">]]</span>
        <span class="n">in_color</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">pyu</span><span class="o">.</span><span class="n">rgb</span><span class="p">(</span><span class="n">inhex</span><span class="p">)</span><span class="o">/</span><span class="mf">255.</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">subject</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;inodes&#39;</span><span class="p">]:</span>
            <span class="n">X</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))])</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="n">X</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">X</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">scale_factor</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;insize&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">in_color</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ant&#39;</span><span class="p">],</span><span class="s1">&#39;SqG&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">],</span>
                           <span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span>
                           <span class="n">ilog</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">minr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                           <span class="n">maxr</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                           <span class="n">newfig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="n">colorbar</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                           <span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;inname&#39;</span><span class="p">]:</span>
            <span class="p">[</span><span class="n">mlab</span><span class="o">.</span><span class="n">text3d</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;s3off&#39;</span><span class="p">],</span>
                        <span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">scale</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;innamesize&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]:</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bodytime&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
                <span class="n">time</span> <span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="c1"># time=range(10,100,20)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">time</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bodytime&#39;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">ki</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">time</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">ib</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">subject</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">cs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">dev</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                    <span class="n">name</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bodyname&#39;</span><span class="p">],</span>
                                    <span class="n">devlist</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;devlist&#39;</span><span class="p">],</span>
                                    <span class="n">devsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;devsize&#39;</span><span class="p">],</span>
                                    <span class="n">tube_sides</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                                    <span class="n">pattern</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;pattern&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tagtraj&#39;</span><span class="p">]:</span>
                        <span class="n">X</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">traj</span><span class="p">[[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">toposFrameId</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tagpoffset&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
                            <span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mf">0.2</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tagpoffset&#39;</span><span class="p">][</span><span class="n">ki</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tagname&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;t=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;s&#39;</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tagname&#39;</span><span class="p">][</span><span class="n">ki</span><span class="p">])</span>
                        <span class="n">mlab</span><span class="o">.</span><span class="n">text3d</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">X</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">name</span><span class="p">,</span><span class="n">scale</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsizetag&#39;</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;interf&#39;</span><span class="p">]:</span>
                    <span class="k">for</span> <span class="n">ib</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">cs</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;bodyname&#39;</span><span class="p">],</span><span class="n">tube_sides</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;trajectory&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">subject</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">traj</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;trajectory_color_range&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;camera&#39;</span><span class="p">]</span> <span class="p">:</span>
            <span class="n">mlab</span><span class="o">.</span><span class="n">points3d</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cam</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="n">scale_factor</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;camerasize&#39;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="n">cam_color</span><span class="p">)</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mf">111.44127634143871</span><span class="p">,</span>
                    <span class="mf">60.40674368088245</span><span class="p">,</span>
                    <span class="mf">24.492297713984197</span><span class="p">,</span>
                    <span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.07235499</span><span class="p">,</span>  <span class="mf">0.04868631</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00314969</span><span class="p">]))</span>
        <span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mf">128.66519195313163</span><span class="p">,</span>
                   <span class="mf">50.708933839573511</span><span class="p">,</span>
                   <span class="mf">24.492297713984247</span><span class="p">,</span>
                   <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.07235499</span><span class="p">,</span>  <span class="mf">0.04868631</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00314969</span><span class="p">]))</span></div>

<div class="viewcode-block" id="CorSer.anim"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.anim.html#pylayers.measures.cormoran.CorSer.anim">[docs]</a>    <span class="k">def</span> <span class="nf">anim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_show3</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">inname</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">trajectory</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">anim</span><span class="p">()</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">]</span>

        <span class="n">mlab</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mf">43.413544538477254</span><span class="p">,</span>
                    <span class="mf">74.048193730704611</span><span class="p">,</span>
                    <span class="mf">11.425837641867618</span><span class="p">,</span>
                    <span class="n">array</span><span class="p">([</span> <span class="mf">0.48298163</span><span class="p">,</span>  <span class="mf">0.67806043</span><span class="p">,</span>  <span class="mf">0.0987967</span> <span class="p">]))</span></div>


<div class="viewcode-block" id="CorSer.imshow"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.imshow.html#pylayers.measures.cormoran.CorSer.imshow">[docs]</a>    <span class="k">def</span> <span class="nf">imshow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; DEPRECATED</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        kind : string</span>

<span class="sd">            &#39;mean&#39;,&#39;std&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rssi</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">rssi</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">timeindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thkb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">time</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">timeindex</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thkb</span><span class="o">-</span><span class="n">time</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">dt1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rssi</span><span class="p">[:,:,</span><span class="n">timeindex</span><span class="p">]</span>
            <span class="n">dt2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">[:,:,</span><span class="n">timeindex</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">dt1</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rssi</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dt2</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span>
            <span class="n">dt1</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rssi</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">dt2</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">D</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
        <span class="c1">#img1 = ax1.imshow(self.rssi[:,:,timeindex],interpolation=&#39;nearest&#39;,origin=&#39;lower&#39;)</span>
        <span class="n">img1</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dt1</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">x</span><span class="p">],</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">17</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span><span class="n">labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span><span class="n">labels</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;time&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;t = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">+</span> <span class="s1">&#39; s&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">u&#39;$mean(\mathbf{L})$&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kind</span><span class="o">==</span><span class="s1">&#39;std&#39;</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">u&#39;$std(\mathbf{L})$&#39;</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
        <span class="n">cax1</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">clb1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img1</span><span class="p">,</span><span class="n">cax1</span><span class="p">)</span>
        <span class="n">clb1</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;level dBm&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
        <span class="c1">#img2 = ax2.imshow(self.D[:,:,timeindex],interpolation=&#39;nearest&#39;,origin=&#39;lower&#39;)</span>
        <span class="n">img2</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dt2</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">u&#39;$\mathbf{L}-\mathbf{L}^T$&#39;</span><span class="p">)</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span><span class="n">labels</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">),</span><span class="n">labels</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">cax2</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">clb2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">img2</span><span class="p">,</span><span class="n">cax2</span><span class="p">)</span>
        <span class="n">clb2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;level dBm&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1">#for k in range(1,17):</span>
        <span class="c1">#    for l in range(1,17):</span>
        <span class="c1">#        self.dHKB[(k,l)]=iHKB[k]+&#39; - &#39;+iHKB[l]</span>
        <span class="c1">#        cpt = cpt + 1</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">lk2nd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lk</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; transcode a lk from Id to real name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        lk : string</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">            &gt;&gt;&gt; C=Corser(6)</span>
<span class="sd">            &gt;&gt;&gt; lk = &#39;HKB:15-HKB:7&#39;</span>
<span class="sd">            &gt;&gt;&gt; C.lk2nd(lk)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;HKB:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)],</span><span class="n">u</span><span class="p">)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<div class="viewcode-block" id="CorSer._load_offset_dict"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._load_offset_dict.html#pylayers.measures.cormoran.CorSer._load_offset_dict">[docs]</a>    <span class="k">def</span> <span class="nf">_load_offset_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; load offset_dictionnary.bin</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        d : dict</span>

<span class="sd">        {&#39;Sc20_S5_R1_HKBS&#39;: {&#39;hkb_index&#39;: -148, &#39;video_sec&#39;: 32.622087273809527},</span>
<span class="sd">        &#39;Sc20_S6_R2_HKBS&#39;: {&#39;bs_index&#39;: -124, &#39;hkb_index&#39;: -157},</span>
<span class="sd">        &#39;Sc21a_S13_R1_HKBS&#39;: {&#39;hkb_index&#39;: 537},</span>
<span class="sd">        &#39;Sc21a_S14_R2_HKBS&#39;: {&#39;hkb_index&#39;: 752},</span>
<span class="sd">        &#39;Sc21a_S15_R3_HKBS&#39;: {&#39;hkb_index&#39;: 438},</span>
<span class="sd">        &#39;Sc21a_S16_R4_HKBS&#39;: {&#39;hkb_index&#39;: 224},</span>
<span class="sd">        &#39;Sc21b_S21_R1_HKBS&#39;: {&#39;hkb_index&#39;: 368},</span>
<span class="sd">        &#39;Sc21b_S22_R2_HKBS&#39;: {&#39;hkb_index&#39;: -333},</span>
<span class="sd">        &#39;Sc21b_S23_R3_HKBS&#39;: {&#39;hkb_index&#39;: 136},</span>
<span class="sd">        &#39;Sc22a_S9_R1_Full&#39;: {&#39;hkb_index&#39;: 678}}</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        This is used for synchronization purpose</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CORMORAN&#39;</span><span class="p">],</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;offset_dictionnary.bin&#39;</span><span class="p">),</span> <span class="s2">&quot;rb&quot;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="CorSer._save_offset_dict"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._save_offset_dict.html#pylayers.measures.cormoran.CorSer._save_offset_dict">[docs]</a>    <span class="k">def</span> <span class="nf">_save_offset_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">d</span><span class="p">):</span>

        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CORMORAN&#39;</span><span class="p">],</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="n">d</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s1">&#39;offset_dictionnary.bin&#39;</span><span class="p">),</span> <span class="s2">&quot;wb&quot;</span> <span class="p">)</span> <span class="p">)</span></div>

<div class="viewcode-block" id="CorSer._save_data_off_dict"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._save_data_off_dict.html#pylayers.measures.cormoran.CorSer._save_data_off_dict">[docs]</a>    <span class="k">def</span> <span class="nf">_save_data_off_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filename</span><span class="p">,</span><span class="n">typ</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; save</span>
<span class="sd">                - a given &quot;value&quot; of an for,</span>
<span class="sd">                - a serie/run &quot;filename&quot;,</span>
<span class="sd">                - of a given typ (video|hkb|tcr|...)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_offset_dict</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">typ</span><span class="p">:</span><span class="n">value</span><span class="p">})</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">d</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">d</span><span class="p">[</span><span class="n">filename</span><span class="p">][</span><span class="n">typ</span><span class="p">]</span><span class="o">=</span><span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_offset_dict</span><span class="p">(</span><span class="n">d</span><span class="p">)</span></div>


<div class="viewcode-block" id="CorSer.offset_setter_video"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.offset_setter_video.html#pylayers.measures.cormoran.CorSer.offset_setter_video">[docs]</a>    <span class="k">def</span> <span class="nf">offset_setter_video</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;AP1&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;WristRight&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; video offset setter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;inverse&#39;</span><span class="p">:</span><span class="bp">True</span>
                    <span class="p">}</span>


        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">ib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ib</span> <span class="o">=</span> <span class="n">bq</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>


        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thkb</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="n">sab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">sabt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="n">hkb</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sabt</span><span class="p">,</span><span class="n">sab</span><span class="p">,</span><span class="n">label</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>


        <span class="k">try</span> <span class="p">:</span> 
            <span class="n">init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">][</span><span class="s1">&#39;video_sec&#39;</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">init</span><span class="o">=</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="n">videofile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rootdir</span><span class="p">,</span><span class="s1">&#39;POST-TREATED&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-06-2014&#39;</span><span class="p">,</span><span class="s1">&#39;Videos&#39;</span><span class="p">)</span>
        <span class="n">ldir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">videofile</span><span class="p">)</span>
        <span class="n">luldir</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filename</span> <span class="ow">in</span> <span class="n">x</span><span class="p">,</span><span class="n">ldir</span><span class="p">)</span>
        <span class="n">uldir</span> <span class="o">=</span> <span class="n">luldir</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">_filename</span> <span class="o">=</span> <span class="n">ldir</span><span class="p">[</span><span class="n">uldir</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">videofile</span><span class="p">,</span><span class="n">_filename</span><span class="p">)</span>
        <span class="n">vc</span> <span class="o">=</span> <span class="n">VideoFileClip</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="n">I0</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
        <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>



        <span class="c1">########</span>
        <span class="c1"># slider</span>
        <span class="c1">########</span>
        <span class="n">slide_xoffset_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
        <span class="n">sliderx</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">slide_xoffset_ax</span><span class="p">,</span> <span class="s2">&quot;video offset&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">valinit</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#AAAAAA&#39;</span><span class="p">)</span>


        <span class="c1"># vertc = [(0,-10),(0,-10),(0,10),(0,-10)]</span>
        <span class="c1"># poly = plt.Polygon(vertc)</span>
        <span class="c1"># pp = axs[1].add_patch(poly)</span>


        <span class="k">def</span> <span class="nf">update_x</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">get_frame</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="n">I0</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">F0</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>

        <span class="c1"># def cursor(val):</span>
        <span class="c1">#     try :</span>
        <span class="c1">#         pp.remove()</span>
        <span class="c1">#     except:</span>
        <span class="c1">#         pass</span>
        <span class="c1">#     vertc = [(sabt[0]+val,min(sab)-10),(sabt[0]+val,min(sab)-10),(sabt[0]+val,max(sab)+10),(sabt[0]+val,max(sab)-10)]</span>
        <span class="c1">#     poly = plt.Polygon(vertc)</span>
        <span class="c1">#     pp = axs[1].add_patch(poly)</span>
        <span class="c1"># sliderx.on_changed(cursor)</span>

        <span class="k">def</span> <span class="nf">plus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">+</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">minus</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">set_val</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">setter</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_data_off_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span><span class="s1">&#39;video_sec&#39;</span><span class="p">,</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_offset_dict</span><span class="p">()</span>
        <span class="n">axp</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axset</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>
        <span class="n">axm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.075</span><span class="p">])</span>

        <span class="n">bp</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axp</span><span class="p">,</span> <span class="s1">&#39;&lt;-&#39;</span><span class="p">)</span>
        <span class="n">bp</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">minus</span><span class="p">)</span>

        <span class="n">bset</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axset</span><span class="p">,</span> <span class="s1">&#39;SET offs.&#39;</span><span class="p">)</span>
        <span class="n">bset</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">setter</span><span class="p">)</span>

        <span class="n">bm</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axm</span><span class="p">,</span> <span class="s1">&#39;-&gt;&#39;</span><span class="p">)</span>
        <span class="n">bm</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">plus</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="CorSer.offset_setter"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.offset_setter.html#pylayers.measures.cormoran.CorSer.offset_setter">[docs]</a>    <span class="k">def</span> <span class="nf">offset_setter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;HKB:1&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;HKB:12&#39;</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; offset setter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;inverse&#39;</span><span class="p">:</span><span class="bp">True</span>
                    <span class="p">}</span>


        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">plt</span><span class="o">.</span><span class="n">isinteractive</span><span class="p">():</span>
            <span class="n">interactive</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">interactive</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">bia</span><span class="p">,</span><span class="n">subja</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">bib</span><span class="p">,</span><span class="n">subjb</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>


        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span>


        <span class="k">try</span> <span class="p">:</span> 
            <span class="n">init</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#self.offset[self._filename][&#39;hkb_index&#39;]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">init</span><span class="o">=</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlinkd</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;inverse&#39;</span><span class="p">]:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">gt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time</span><span class="p">,</span><span class="n">var</span><span class="p">)</span>


        <span class="n">ab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlink</span><span class="p">(</span><span class="n">ia</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">sab</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">values</span>
        <span class="n">sabt</span> <span class="o">=</span> <span class="n">ab</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">technoval</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sabt</span><span class="p">,</span><span class="n">sab</span><span class="p">)</span>


        <span class="c1">########</span>
        <span class="c1"># slider</span>
        <span class="c1">########</span>
        <span class="n">slide_xoffset_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">])</span>
        <span class="n">sliderx</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">slide_xoffset_ax</span><span class="p">,</span> <span class="n">techno</span> <span class="o">+</span> <span class="s2">&quot; offset&quot;</span><span class="p">,</span> <span class="o">-</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sabt</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">),</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sabt</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">),</span>
                        <span class="n">valinit</span><span class="o">=</span><span class="n">init</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#AAAAAA&#39;</span><span class="p">)</span>

        <span class="n">slide_yoffset_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">])</span>
        <span class="n">slidery</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">slide_yoffset_ax</span><span class="p">,</span> <span class="s2">&quot;gt_yoff&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">valinit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#AAAAAA&#39;</span><span class="p">)</span>

        <span class="n">slide_alpha_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">])</span>
        <span class="n">slideralpha</span> <span class="o">=</span> <span class="n">Slider</span><span class="p">(</span><span class="n">slide_alpha_ax</span><span class="p">,</span> <span class="s2">&quot;gt_alpha&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span>
                        <span class="n">valinit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#AAAAAA&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">update_x</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
            <span class="n">rtechnoval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">sab</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>
            <span class="n">sliderx</span><span class="o">.</span><span class="n">valtext</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="n">technoval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">sabt</span><span class="p">)</span>
            <span class="n">technoval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">rtechnoval</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_x</span><span class="p">)</span>
        <span class="n">sliderx</span><span class="o">.</span><span class="n">drawon</span> <span class="o">=</span> <span class="bp">False</span>


        <span class="k">def</span> <span class="nf">update_y</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">yoff</span> <span class="o">=</span> <span class="n">slidery</span><span class="o">.</span><span class="n">val</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="n">slideralpha</span><span class="o">.</span><span class="n">val</span>
            <span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">var</span> <span class="o">+</span> <span class="n">yoff</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw_idle</span><span class="p">()</span>
        <span class="c1">#initpurpose</span>
        <span class="n">update_y</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">slidery</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_y</span><span class="p">)</span>
        <span class="n">slideralpha</span><span class="o">.</span><span class="n">on_changed</span><span class="p">(</span><span class="n">update_y</span><span class="p">)</span>


        <span class="k">def</span> <span class="nf">setter</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sliderx</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
            <span class="k">try</span> <span class="p">:</span>
                <span class="n">nval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">][</span><span class="n">techno</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_index&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">value</span>
            <span class="k">except</span> <span class="p">:</span> 
                <span class="n">nval</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_save_data_off_dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span><span class="n">techno</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_index&#39;</span><span class="p">,</span><span class="n">nval</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_offset_dict</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;WARNING : Please Reload serie to Valide offset change&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>

        <span class="n">axset</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">])</span>
        <span class="n">bset</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">axset</span><span class="p">,</span> <span class="s1">&#39;SET &#39;</span> <span class="o">+</span><span class="n">techno</span><span class="o">+</span><span class="s1">&#39; offs.&#39;</span><span class="p">)</span>
        <span class="n">bset</span><span class="o">.</span><span class="n">on_clicked</span><span class="p">(</span><span class="n">setter</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">interactive</span> <span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span></div>


    <span class="c1"># def offset_setter_hkb(self,a=&#39;AP1&#39;,b=&#39;WristRight&#39;,**kwargs):</span>
    <span class="c1">#     &quot;&quot;&quot; offset setter</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     defaults = { &#39;inverse&#39;:True</span>
    <span class="c1">#                 }</span>


    <span class="c1">#     for k in defaults:</span>
    <span class="c1">#         if k not in kwargs:</span>
    <span class="c1">#             kwargs[k] = defaults[k]</span>

    <span class="c1">#     if plt.isinteractive():</span>
    <span class="c1">#         interactive = True</span>
    <span class="c1">#         plt.ioff()</span>
    <span class="c1">#     else :</span>
    <span class="c1">#         interactive = False</span>

    <span class="c1">#     fig, ax = plt.subplots()</span>
    <span class="c1">#     fig.subplots_adjust(bottom=0.2, left=0.3)</span>

    <span class="c1">#     a,ia,bia,subja,techno=self.devmapper(a,&#39;HKB&#39;)</span>
    <span class="c1">#     b,ib,bib,subjb,techno=self.devmapper(b,&#39;HKB&#39;)</span>


    <span class="c1">#     time = self.thkb</span>
    <span class="c1">#     if len(time.shape) == 2:</span>
    <span class="c1">#         time = time[0,:]</span>


    <span class="c1">#     try : </span>
    <span class="c1">#         init = time[0]#self.offset[self._filename][&#39;hkb_index&#39;]</span>
    <span class="c1">#     except:</span>
    <span class="c1">#         init=time[0]</span>


    <span class="c1">#     var = self.getlinkd(ia,ib,&#39;HKB&#39;).values</span>
    <span class="c1">#     if kwargs[&#39;inverse&#39;]:</span>
    <span class="c1">#         var = 10*np.log10(1./(var)**2)</span>
    <span class="c1">#     gt = ax.plot(self.B[self.B.keys()[0]].time,var)</span>

    <span class="c1">#     sab = self.hkb[a+&#39;-&#39;+b].values</span>
    <span class="c1">#     sabt = self.hkb[a+&#39;-&#39;+b].index</span>
    <span class="c1">#     hkb = ax.plot(sabt,sab)</span>


    <span class="c1">#     ########</span>
    <span class="c1">#     # slider</span>
    <span class="c1">#     ########</span>
    <span class="c1">#     slide_xoffset_ax = plt.axes([0.1, 0.15, 0.8, 0.02])</span>
    <span class="c1">#     sliderx = Slider(slide_xoffset_ax, &quot;hkb offset&quot;, -(len(sabt)/16), (len(sabt)/16),</span>
    <span class="c1">#                     valinit=init, color=&#39;#AAAAAA&#39;)</span>

    <span class="c1">#     slide_yoffset_ax = plt.axes([0.1, 0.10, 0.8, 0.02])</span>
    <span class="c1">#     slidery = Slider(slide_yoffset_ax, &quot;gt_yoff&quot;, -100, 0,</span>
    <span class="c1">#                     valinit=0, color=&#39;#AAAAAA&#39;)</span>

    <span class="c1">#     slide_alpha_ax = plt.axes([0.1, 0.05, 0.8, 0.02])</span>
    <span class="c1">#     slideralpha = Slider(slide_alpha_ax, &quot;gt_alpha&quot;, 0, 10,</span>
    <span class="c1">#                     valinit=5, color=&#39;#AAAAAA&#39;)</span>

    <span class="c1">#     def update_x(val):</span>
    <span class="c1">#         value = int(sliderx.val)</span>
    <span class="c1">#         rhkb = np.roll(sab,value)</span>
    <span class="c1">#         sliderx.valtext.set_text(&#39;{}&#39;.format(value))</span>
    <span class="c1">#         hkb[0].set_xdata(sabt)</span>
    <span class="c1">#         hkb[0].set_ydata(rhkb)</span>
    <span class="c1">#         fig.canvas.draw_idle()</span>
    <span class="c1">#     sliderx.on_changed(update_x)</span>
    <span class="c1">#     sliderx.drawon = False</span>


    <span class="c1">#     def update_y(val):</span>
    <span class="c1">#         yoff = slidery.val</span>
    <span class="c1">#         alpha = slideralpha.val</span>
    <span class="c1">#         gt[0].set_ydata(alpha*var + yoff)</span>
    <span class="c1">#         fig.canvas.draw_idle()</span>
    <span class="c1">#     #initpurpose</span>
    <span class="c1">#     update_y(5)</span>
    <span class="c1">#     slidery.on_changed(update_y)</span>
    <span class="c1">#     slideralpha.on_changed(update_y)</span>


    <span class="c1">#     def setter(event):</span>
    <span class="c1">#         value = int(sliderx.val)</span>
    <span class="c1">#         try :</span>
    <span class="c1">#             nval = self.offset[self._filename][&#39;hkb_index&#39;] + value</span>
    <span class="c1">#         except : </span>
    <span class="c1">#             nval = value</span>
    <span class="c1">#         self._save_data_off_dict(self._filename,&#39;hkb_index&#39;,nval)</span>
    <span class="c1">#         self.offset= self._load_offset_dict()</span>
    <span class="c1">#         ax.set_title(&#39;WARNING : Please Reload serie to Valide offset change&#39;,color=&#39;r&#39;,weight=&#39;bold&#39;)</span>
    <span class="c1">#     axset = plt.axes([0.0, 0.5, 0.2, 0.05])</span>

    <span class="c1">#     bset = Button(axset, &#39;SET offs.&#39;)</span>
    <span class="c1">#     bset.on_clicked(setter)</span>


    <span class="c1">#     plt.show()</span>
    <span class="c1">#     if interactive:</span>
    <span class="c1">#         plt.ion()</span>


    <span class="k">def</span> <span class="nf">mtlbsave</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Matlab format save</span>


<span class="sd">        S{day}_{serie}</span>
<span class="sd">            node_name</span>
<span class="sd">            node_place</span>
<span class="sd">            node_coord</span>

<span class="sd">            HKB.{linkname}.tr</span>
<span class="sd">            HKB.{linkname}.rssi</span>
<span class="sd">            HKB.{linkname}.td</span>
<span class="sd">            HKB.{linkname}.dist</span>
<span class="sd">            HKB.{linkname}.sh</span>
<span class="sd">            HKB.{linkname}.dsh</span>

<span class="sd">            TCR.{linkname}.tr</span>
<span class="sd">            HKB.{linkname}.range</span>
<span class="sd">            HKB.{linkname}.td</span>
<span class="sd">            HKB.{linkname}.dist</span>
<span class="sd">            HKB.{linkname}.sh</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;S&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">day</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">serie</span><span class="p">)</span>
        <span class="n">filemat</span> <span class="o">=</span> <span class="n">key</span><span class="o">+</span><span class="s1">&#39;.mat&#39;</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;node_name&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;node_place&#39;</span><span class="p">]</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="bp">self</span><span class="o">.</span><span class="n">dist_nodesmap</span><span class="p">)</span>
        <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;node_coord&#39;</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">points</span>

        <span class="k">for</span> <span class="n">subject</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interf</span><span class="p">:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">subject</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">sub</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;HKB&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">links</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">inter</span><span class="p">,</span><span class="n">lks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_visibility</span><span class="p">(</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                <span class="n">ls</span>   <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="n">nl</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nl</span><span class="o">=</span><span class="n">nl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Jihad&#39;</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Nicolas&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Eric&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;HKB&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">ix0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lks</span><span class="o">==</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ix1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lks</span><span class="o">==</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Ssh</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="n">ix0</span><span class="p">,</span><span class="n">ix1</span><span class="p">,:]</span>
                <span class="n">Srssi</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlink</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
                <span class="c1"># get distances between nodes</span>
                <span class="n">Sdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlinkd</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
                <span class="n">dsh</span> <span class="o">=</span> <span class="n">dist_sh2rssi</span><span class="p">(</span><span class="n">Sdist</span><span class="p">,</span><span class="n">Ssh</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span>
                <span class="c1"># rssi</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;HKB&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">][</span><span class="s1">&#39;rssi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Srssi</span><span class="o">.</span><span class="n">values</span>
                <span class="c1"># dsh</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;HKB&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">][</span><span class="s1">&#39;dsh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dsh</span>
                <span class="c1">#d[&#39;S6&#39;][nl][&#39;rssi_dec&#39;] = np.roll(Srssi.values,-dec)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;HKB&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">][</span><span class="s1">&#39;sh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ssh</span>
                <span class="c1"># time rssi</span>
                <span class="c1">#d[key][&#39;HKB&#39;][nl][&#39;trh&#39;] = np.array(Srssi.index)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;trh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Srssi</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="c1"># distance</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;HKB&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sdist</span><span class="o">.</span><span class="n">values</span>
                <span class="c1"># time mocap</span>
                <span class="c1">#d[key][&#39;HKB&#39;][nl][&#39;td&#39;] = np.array(Sdist.index)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;tm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Sdist</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;TCR&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">links</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
            <span class="n">inter</span><span class="p">,</span><span class="n">lks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_visibility</span><span class="p">(</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links</span><span class="p">:</span>
                <span class="n">ls</span>   <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
                <span class="c1"># to shorten matlab keys surname are replaced by first letter</span>
                <span class="n">nl</span> <span class="o">=</span> <span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">nl</span><span class="o">=</span><span class="n">nl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Jihad&#39;</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Nicolas&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;Eric&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;TCR&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">ix0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lks</span><span class="o">==</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">ix1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lks</span><span class="o">==</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># intersection on the link</span>
                <span class="n">Ssh</span> <span class="o">=</span> <span class="n">inter</span><span class="p">[</span><span class="n">ix0</span><span class="p">,</span><span class="n">ix1</span><span class="p">,:]</span>
                <span class="n">Srange</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlink</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
                <span class="c1"># get distances between nodes</span>
                <span class="n">Sdist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlinkd</span><span class="p">(</span><span class="n">ls</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ls</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
                <span class="c1"># rssi</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;TCR&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">][</span><span class="s1">&#39;range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Srange</span><span class="o">.</span><span class="n">values</span>
                <span class="c1"># dsh</span>
                <span class="c1">#d[&#39;S6&#39;][nl][&#39;rssi_dec&#39;] = np.roll(Srssi.values,-dec)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;TCR&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">][</span><span class="s1">&#39;sh&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ssh</span>
                <span class="c1"># time rssi</span>
                <span class="c1">#d[key][&#39;TCR&#39;][nl][&#39;tr&#39;] = np.array(Srange.index)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;trt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Srange</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
                <span class="c1"># distance</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;TCR&#39;</span><span class="p">][</span><span class="n">nl</span><span class="p">][</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sdist</span><span class="o">.</span><span class="n">values</span>
                <span class="c1"># time mocap</span>
                <span class="c1">#d[key][&#39;TCR&#39;][nl][&#39;td&#39;] = np.array(Sdist.index)</span>
                <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s1">&#39;tm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Sdist</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">matlab</span> <span class="o">=</span> <span class="n">d</span>
        <span class="n">io</span><span class="o">.</span><span class="n">savemat</span><span class="p">(</span><span class="n">filemat</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>





<div class="viewcode-block" id="CorSer.pltvisi"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.pltvisi.html#pylayers.measures.cormoran.CorSer.pltvisi">[docs]</a>    <span class="k">def</span> <span class="nf">pltvisi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot visibility between link a and b</span>


<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        color:</span>
<span class="sd">            fill color</span>
<span class="sd">        hatch:</span>
<span class="sd">            hatch type</span>
<span class="sd">        label_pos: (&#39;top&#39;|&#39;bottom&#39;|&#39;&#39;)</span>
<span class="sd">            postion of the label</span>
<span class="sd">        label_pos_off: float</span>
<span class="sd">            offset of postion of the label</span>
<span class="sd">        label_mob: str</span>
<span class="sd">            prefix of label in mobility</span>
<span class="sd">        label_stat: str</span>
<span class="sd">            prefix of label static</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S = CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.plthkb(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.pltvisi(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;,fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.pltmob(fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; plt.title(&#39;hatch = visibility / gray= mobility&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;hatch&#39;</span><span class="p">:</span><span class="s1">&#39;//&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label_pos&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label_pos_off&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                     <span class="s1">&#39;label_vis&#39;</span><span class="p">:</span><span class="s1">&#39;V&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label_hide&#39;</span><span class="p">:</span><span class="s1">&#39;H&#39;</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>



        <span class="n">aa</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>

        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">nna</span><span class="p">,</span><span class="n">subjecta</span><span class="p">,</span><span class="n">technoa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">nnb</span><span class="p">,</span><span class="n">subjectb</span><span class="p">,</span><span class="n">technob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">vv</span><span class="p">,</span><span class="n">tv</span><span class="p">,</span><span class="n">tseg</span><span class="p">,</span><span class="n">itseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visiarray</span><span class="p">(</span><span class="n">nna</span><span class="p">,</span><span class="n">nnb</span><span class="p">)</span>
        <span class="c1"># vv.any : it exist NLOS regions</span>
        <span class="k">if</span> <span class="n">vv</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plu</span><span class="o">.</span><span class="n">rectplot</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span><span class="n">tseg</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span>
                                    <span class="n">fill</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                    <span class="n">hatch</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hatch&#39;</span><span class="p">],</span>
                                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

            <span class="k">else</span> <span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plu</span><span class="o">.</span><span class="n">rectplot</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span><span class="n">tseg</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                    <span class="n">hatch</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hatch&#39;</span><span class="p">],</span>
                                    <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
                    <span class="n">yposV</span> <span class="o">=</span> <span class="n">aa</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
                    <span class="n">yposH</span> <span class="o">=</span> <span class="n">aa</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span>

                <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
                    <span class="n">yposV</span> <span class="o">=</span> <span class="n">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
                    <span class="n">yposH</span> <span class="o">=</span> <span class="n">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
                <span class="n">xposV</span><span class="o">=</span> <span class="n">tv</span><span class="p">[</span><span class="n">tseg</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span>
                <span class="n">xposH</span><span class="o">=</span> <span class="n">tv</span><span class="p">[</span><span class="n">itseg</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span>
                <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yposV</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_vis&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">ix</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xposV</span><span class="p">)]</span>
                <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yposH</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_hide&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span> <span class="k">for</span> <span class="n">ix</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xposH</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="CorSer.pltmob"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.pltmob.html#pylayers.measures.cormoran.CorSer.pltmob">[docs]</a>    <span class="k">def</span> <span class="nf">pltmob</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot mobility</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        subject: str</span>
<span class="sd">            subject to display () if &#39;&#39;, take the fist one from self.subject)</span>
<span class="sd">        showvel :  boolean</span>
<span class="sd">            display filtered velocity</span>
<span class="sd">        velth: float (0.7)</span>
<span class="sd">            velocity threshold</span>
<span class="sd">        fo : int (5)</span>
<span class="sd">            filter order</span>
<span class="sd">        fw: float (0.02)</span>
<span class="sd">            0 &lt; fw &lt; 1  (fN &lt;=&gt; 1)</span>
<span class="sd">        time_offset : int</span>
<span class="sd">            add time_offset to start later</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S = CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.plthkb(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; #f,ax = S.pltvisi(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;,fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.pltmob(fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; plt.title(&#39;hatch = visibility / gray= mobility&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;subject&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                    <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;showvel&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;velth&#39;</span><span class="p">:</span><span class="mf">0.07</span><span class="p">,</span>
                     <span class="s1">&#39;fo&#39;</span><span class="p">:</span><span class="mi">5</span><span class="p">,</span>
                     <span class="s1">&#39;fw&#39;</span><span class="p">:</span><span class="mf">0.02</span><span class="p">,</span>
                     <span class="s1">&#39;ylim&#39;</span><span class="p">:(),</span>
                     <span class="s1">&#39;time_offset&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;hatch&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label_pos&#39;</span><span class="p">:</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label_pos_off&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span>
                     <span class="s1">&#39;label_mob&#39;</span><span class="p">:</span><span class="s1">&#39;M&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;label_stat&#39;</span><span class="p">:</span><span class="s1">&#39;S&#39;</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>

        <span class="n">V</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">traj</span><span class="p">[[</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">Vi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">V</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">V</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">f</span><span class="o">=</span><span class="n">DF</span><span class="p">()</span>
        <span class="n">f</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fo&#39;</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fw&#39;</span><span class="p">],</span><span class="s1">&#39;lowpass&#39;</span><span class="p">)</span>
        <span class="n">Vif</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Vi</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_offset&#39;</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">zmo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_offset&#39;</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Vif</span><span class="p">,</span><span class="n">zmo</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">Vif</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">Vif</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">zmo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_offset&#39;</span><span class="p">])</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Vif</span><span class="p">,</span><span class="n">zmo</span><span class="p">))</span>
            <span class="n">Vif</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_offset&#39;</span><span class="p">]:</span><span class="nb">len</span><span class="p">(</span><span class="n">Vif</span><span class="p">)</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;time_offset&#39;</span><span class="p">]]</span>


        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;showvel&#39;</span><span class="p">]:</span>
            <span class="n">fig2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ax2</span><span class="o">=</span><span class="n">fig2</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">Vif</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vif</span><span class="p">)</span>
            <span class="n">cursor2</span> <span class="o">=</span> <span class="n">Cursor</span><span class="p">(</span><span class="n">ax2</span><span class="p">,</span> <span class="n">useblit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">null</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Vif</span><span class="o">&lt;</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;velth&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unu1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="o">!=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unu2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">null</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">!=-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">unu2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="o">-</span><span class="n">unu2</span>
        <span class="n">unu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">unu1</span><span class="p">,</span><span class="n">unu2</span><span class="p">))</span>
        <span class="n">unu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">unu</span><span class="p">)</span>
        <span class="n">sunu</span> <span class="o">=</span> <span class="n">unu</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="n">sunu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">unu</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">unu</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">null</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">sunu</span> <span class="o">=</span> <span class="n">unu</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">nullr</span><span class="o">=</span><span class="n">null</span><span class="p">[</span><span class="n">unu</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">sunu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="p">():</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">axlim</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
            <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="n">axlim</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">axlim</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>


        <span class="n">fig</span> <span class="p">,</span> <span class="n">ax</span> <span class="o">=</span><span class="n">plu</span><span class="o">.</span><span class="n">rectplot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">,</span><span class="n">nullr</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span>
                                <span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span>
                                <span class="n">hatch</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;hatch&#39;</span><span class="p">],</span>
                                <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>


        <span class="n">inullr</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">nullr</span><span class="p">)</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">inullr</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">inullr</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">null</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">inullr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">bb</span><span class="p">,</span><span class="n">ee</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># remove last</span>
        <span class="n">inullr</span> <span class="o">=</span> <span class="n">inullr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span>
                <span class="n">yposM</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
                <span class="n">yposS</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span>

            <span class="k">elif</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">:</span>
                <span class="n">yposM</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
                <span class="n">yposS</span> <span class="o">=</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_pos_off&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span>
            <span class="n">xposM</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">nullr</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span>
            <span class="n">xposS</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">inullr</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yposM</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_mob&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xposM</span><span class="p">)]</span>
            <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">yposS</span><span class="p">,</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label_stat&#39;</span><span class="p">]</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">ix</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xposS</span><span class="p">)]</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

<div class="viewcode-block" id="CorSer.animhkb"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.animhkb.html#pylayers.measures.cormoran.CorSer.animhkb">[docs]</a>    <span class="k">def</span> <span class="nf">animhkb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : node name |number</span>
<span class="sd">        b : node name | number</span>
<span class="sd">        save : bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="kn">as</span> <span class="nn">animation</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span>
        <span class="n">link</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">link</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
            <span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">line</span>

        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
                                      <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">link</span><span class="o">+</span><span class="s1">&#39;.mp4&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;RSS (dBm)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="CorSer.animhkbAP"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.animhkbAP.html#pylayers.measures.cormoran.CorSer.animhkbAP">[docs]</a>    <span class="k">def</span> <span class="nf">animhkbAP</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">AP_list</span><span class="p">,</span><span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : node name</span>
<span class="sd">        AP_nb=[]</span>
<span class="sd">        save : bool</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>
<span class="sd">            &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">            &gt;&gt;&gt; S = CorSer(6)</span>
<span class="sd">            &gt;&gt;&gt; S.animhkbAP(&#39;TorsoTopLeft&#39;,[&#39;AP1&#39;,&#39;AP2&#39;,&#39;AP3&#39;,&#39;AP4&#39;],interval=100,xstart=58,figsize=(20,2))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="kn">as</span> <span class="nn">animation</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span>   <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                       <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
                        <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                        <span class="s1">&#39;label&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;xstart&#39;</span><span class="p">:</span><span class="mi">0</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>


        <span class="n">ust</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span><span class="o">&gt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xstart&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">ust</span><span class="p">:]</span>
        <span class="n">links</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">AP_list</span><span class="p">]</span>
        <span class="n">ly</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">l</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">ust</span><span class="p">:]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">links</span><span class="p">]</span>

        <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xstart&#39;</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">animated</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span>
                        <span class="n">label</span><span class="o">=</span><span class="n">AP_list</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">iy</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ly</span><span class="p">)]</span>

        <span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">iy</span><span class="p">,</span><span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ly</span><span class="p">):</span>
                <span class="n">line</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_ydata</span><span class="p">(</span><span class="n">y</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>
                <span class="n">line</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_xdata</span><span class="p">(</span><span class="n">x</span><span class="p">[:</span><span class="n">i</span><span class="p">])</span>

            <span class="k">return</span> <span class="n">line</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;time (s)&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;RSS (dBm)&#39;</span><span class="p">)</span>
        <span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span>
                                      <span class="n">interval</span><span class="o">=</span><span class="n">interval</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;.mp4&#39;</span><span class="p">)</span>
        <span class="c1">#plt.title(links)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="CorSer.plot"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.plot.html#pylayers.measures.cormoran.CorSer.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : str | int</span>
<span class="sd">            name |id</span>
<span class="sd">        b : str | int</span>
<span class="sd">            name |id</span>
<span class="sd">        techno : str (optional)</span>
<span class="sd">            radio techno</span>
<span class="sd">        t : float | list (optional)</span>
<span class="sd">            given time</span>
<span class="sd">            or [start,stop] time</span>

<span class="sd">        color : color</span>
<span class="sd">        distance : boolean (False)</span>
<span class="sd">            plot distance instead of value</span>
<span class="sd">        lin : boolean (False)</span>
<span class="sd">            display linear value instead of dB</span>
<span class="sd">        sqrtinv : boolean (False)</span>
<span class="sd">            apply : &quot;sqrt (1/ dataset)&quot;</span>
<span class="sd">        xoffset : float (0)</span>
<span class="sd">            add an offset on x axis</span>
<span class="sd">        yoffset :  float (1|1e3|1e6)</span>
<span class="sd">            add an offset on y axis</span>
<span class="sd">        </span>
<span class="sd">        title : boolean (True)</span>
<span class="sd">            display title</span>
<span class="sd">        shortlabel : boolean (True)</span>
<span class="sd">            enable short labelling</span>
<span class="sd">        fontsize : int (18)</span>
<span class="sd">            font size</span>

<span class="sd">        returnlines : boolean</span>
<span class="sd">            if True return the matplotlib ploted lines</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S = CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.plot(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.pltvisi(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;,fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; #f,ax = S.pltmob(fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; #plt.title(&#39;hatch = visibility / gray= mobility&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">6</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span>
                     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;distance&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;lin&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;xoffset&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;yoffset&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span>
                     <span class="s1">&#39;sqrtinv&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;shortlabel&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
                     <span class="s1">&#39;returnlines&#39;</span><span class="p">:</span><span class="bp">False</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">bia</span><span class="p">,</span><span class="n">subja</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">bib</span><span class="p">,</span><span class="n">subjb</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>

        <span class="c1">###create a short labeling</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;shortlabel&#39;</span><span class="p">]:</span>

            <span class="c1">#find uppercase position</span>
            <span class="n">uu</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#cretae string from list</span>
            <span class="n">labela</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uu</span><span class="p">])</span>

            <span class="n">uu</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">b</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#cretae string from list</span>
            <span class="n">labelb</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uu</span><span class="p">])</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">labela</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">labelb</span>

            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;dist &#39;</span> <span class="o">+</span> <span class="n">label</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span><span class="p">[]:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>


        <span class="c1"># get dataframe</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlink</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Received Power between &#39;</span> <span class="o">+</span> <span class="n">label</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Received Power dBm&#39;</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlinkd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Distance  between &#39;</span> <span class="o">+</span> <span class="n">label</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;distance (m)&#39;</span>


        <span class="c1">#post processing on dataframe</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">]:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">df</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span>
            
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;sqrtinv&#39;</span><span class="p">]:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">df</span><span class="p">)</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">u&#39;$ (mW)^{-1/2} linear scale$&#39;</span>

        <span class="n">lines</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

        <span class="c1"># Managing labelling</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;mW&#39;</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1e3</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">u&#39;$\micro$W&#39;</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1e6</span><span class="p">:</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">u&#39;nW&#39;</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="c1"># if kwargs[&#39;data&#39;]==True:</span>
        <span class="c1">#     #ax.plot(self.thkb[0],self.rssi[ia,ib,:])</span>
        <span class="c1">#     #ax.plot(self.thkb[0],self.rssi[ib,ia,:])</span>
        <span class="c1">#     sab = self.hkb[a+&#39;-&#39;+b]</span>

        <span class="c1">#     if not(kwargs[&#39;dB&#39;]):</span>
        <span class="c1">#         sab = 10**(sab/10) * kwargs[&#39;yoffset&#39;]</span>
        <span class="c1">#         if kwargs[&#39;distance&#39;]:</span>
        <span class="c1">#             sab = np.sqrt(1/sab)</span>
        <span class="c1">#         if kwargs[&#39;reciprocal&#39;]:</span>
        <span class="c1">#             sba = 10**(sba/10 ) * kwargs[&#39;yoffset&#39;]</span>
        <span class="c1">#             sba = np.sqrt(1/sba)</span>
        <span class="c1">#     sab[t0:t1].plot(ax=ax,color=kwargs[&#39;colorab&#39;],label=label,xlim=(t0,t1))</span>
        <span class="c1">#     if kwargs[&#39;reciprocal&#39;]:</span>
        <span class="c1">#         sba[t0:t1].plot(ax=ax,color=kwargs[&#39;colorba&#39;],label=label)</span>

        <span class="c1">#     #title = &#39;Received Power   &#39; + self.title1</span>
        <span class="c1">#     if kwargs[&#39;dis_title&#39;]:</span>
        <span class="c1">#         #title = self.title1+kwargs[&#39;tit&#39;]</span>
        <span class="c1">#         title = kwargs[&#39;tit&#39;]</span>
        <span class="c1">#         ax.set_title(label=title,fontsize=kwargs[&#39;fontsize&#39;])</span>
        <span class="c1">#     if not kwargs[&#39;distance&#39;]:</span>
        <span class="c1">#         if kwargs[&#39;dB&#39;]:</span>
        <span class="c1">#             ax.set_ylabel(&#39;Received Power dBm&#39;)</span>
        <span class="c1">#         else:</span>
        <span class="c1">#             if kwargs[&#39;yoffset&#39;]==1:</span>
        <span class="c1">#                 ax.set_ylabel(&#39;mW&#39;)</span>
        <span class="c1">#             if kwargs[&#39;yoffset&#39;]==1e3:</span>
        <span class="c1">#                 ax.set_ylabel(u&#39;$\micro$W&#39;)</span>
        <span class="c1">#             if kwargs[&#39;yoffset&#39;]==1e6:</span>
        <span class="c1">#                 ax.set_ylabel(u&#39;nW&#39;)</span>

        <span class="c1">#     else:</span>
        <span class="c1">#         ax.set_ylabel(u&#39;$\prop (mW)^{-1/2} linear scale$&#39;)</span>

        <span class="c1"># if kwargs[&#39;reciprocal&#39;]==True:</span>
        <span class="c1">#     # if kwargs[&#39;data&#39;]==True:</span>
        <span class="c1">#     #     ax2=fig.add_subplot(212)</span>
        <span class="c1">#     r = self.hkb[a+&#39;-&#39;+b][self.hkb[a+&#39;-&#39;+b]!=0]- self.hkb[b+&#39;-&#39;+a][self.hkb[b+&#39;-&#39;+a]!=0]</span>
        <span class="c1">#     r[t0:t1].plot(ax=ax2)</span>
        <span class="c1">#     ax2.set_title(&#39;Reciprocity offset&#39;,fontsize=kwargs[&#39;fontsize&#39;])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;returnlines&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">lines</span></div>


    <span class="k">def</span> <span class="nf">plthkb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        DEPRECATED</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : node name |number</span>
<span class="sd">        b : node name | number</span>
<span class="sd">        t0 : start time</span>
<span class="sd">        t1 : stop time</span>


<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S = CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.plthkb(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.pltvisi(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;,techno=&#39;HKB&#39;,fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; f,ax = S.pltmob(fig=f,ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; plt.title(&#39;hatch = visibility / gray= mobility&#39;)</span>
<span class="sd">        &gt;&gt;&gt; plt.show()</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;t0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;t1&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
                     <span class="s1">&#39;xoffset&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;yoffset&#39;</span><span class="p">:</span> <span class="mf">1e6</span><span class="p">,</span>
                     <span class="s1">&#39;reciprocal&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;dB&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;colorab&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;colorba&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;distance&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">18</span><span class="p">,</span>
                    <span class="s1">&#39;shortlabel&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;dis_title&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                    <span class="s1">&#39;xlim&#39;</span><span class="p">:(),</span>
                    <span class="s1">&#39;tit&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="n">t0</span> <span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span>
        <span class="n">t1</span> <span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thkb</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">thkb</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">bia</span><span class="p">,</span><span class="n">subja</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">bib</span><span class="p">,</span><span class="n">subjb</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;shortlabel&#39;</span><span class="p">]:</span>

            <span class="c1">#find uppercase position</span>
            <span class="n">uu</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">a</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#cretae string from list</span>
            <span class="n">labela</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uu</span><span class="p">])</span>

            <span class="n">uu</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">([</span><span class="n">l</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="ow">or</span> <span class="n">l</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">b</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
            <span class="c1">#cretae string from list</span>
            <span class="n">labelb</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uu</span><span class="p">])</span>

            <span class="n">label</span> <span class="o">=</span> <span class="n">labela</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">labelb</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">label</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reciprocal&#39;</span><span class="p">]:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
                <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="c1">#ax.plot(self.thkb[0],self.rssi[ia,ib,:])</span>
            <span class="c1">#ax.plot(self.thkb[0],self.rssi[ib,ia,:])</span>
            <span class="n">sab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">]</span>

            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dB&#39;</span><span class="p">]):</span>
                <span class="n">sab</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">sab</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]:</span>
                    <span class="n">sab</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sab</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reciprocal&#39;</span><span class="p">]:</span>
                    <span class="n">sba</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">sba</span><span class="o">/</span><span class="mi">10</span> <span class="p">)</span> <span class="o">*</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span>
                    <span class="n">sba</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">sba</span><span class="p">)</span>
            <span class="n">sab</span><span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">t1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorab&#39;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">t1</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reciprocal&#39;</span><span class="p">]:</span>
                <span class="n">sba</span><span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">t1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorba&#39;</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>

            <span class="c1">#title = &#39;Received Power   &#39; + self.title1</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dis_title&#39;</span><span class="p">]:</span>
                <span class="c1">#title = self.title1+kwargs[&#39;tit&#39;]</span>
                <span class="n">title</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tit&#39;</span><span class="p">]</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;distance&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;dB&#39;</span><span class="p">]:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Received Power dBm&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mW&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1e3</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">u&#39;$\micro$W&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;yoffset&#39;</span><span class="p">]</span><span class="o">==</span><span class="mf">1e6</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">u&#39;nW&#39;</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">u&#39;$\prop (mW)^{-1/2} linear scale$&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;reciprocal&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="c1"># if kwargs[&#39;data&#39;]==True:</span>
            <span class="c1">#     ax2=fig.add_subplot(212)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a</span><span class="p">][</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">r</span><span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">t1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Reciprocity offset&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>

<div class="viewcode-block" id="CorSer.plttcr"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.plttcr.html#pylayers.measures.cormoran.CorSer.plttcr">[docs]</a>    <span class="k">def</span> <span class="nf">plttcr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : node name |number</span>
<span class="sd">        b : node name | number</span>
<span class="sd">        t0 : start time</span>
<span class="sd">        t1 : stop time</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;t0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;t1&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
                     <span class="s1">&#39;data&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;colorab&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;colorba&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;inverse&#39;</span><span class="p">:</span><span class="bp">False</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>


        <span class="n">t0</span> <span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span>
        <span class="n">t1</span> <span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t1&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">t1</span> <span class="o">==-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">t1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ttcr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ia</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="n">ib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ib</span> <span class="o">=</span> <span class="n">b</span>
            <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span>
            <span class="c1">#ax.plot(self.thkb[0],self.rssi[ia,ib,:])</span>
            <span class="c1">#ax.plot(self.thkb[0],self.rssi[ib,ia,:])</span>
            <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;inverse&#39;</span><span class="p">]:</span>
                <span class="n">sab</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">sba</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="p">[</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">]</span>
                <span class="n">sba</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="p">[</span><span class="n">b</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">a</span><span class="p">]</span>
            <span class="n">sab</span><span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">t1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorab&#39;</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">])</span>
            <span class="n">sba</span><span class="p">[</span><span class="n">t0</span><span class="p">:</span><span class="n">t1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorba&#39;</span><span class="p">],</span><span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>


<div class="viewcode-block" id="CorSer.pltgt"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.pltgt.html#pylayers.measures.cormoran.CorSer.pltgt">[docs]</a>    <span class="k">def</span> <span class="nf">pltgt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plt ground truth</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        t0</span>
<span class="sd">        t1</span>
<span class="sd">        fig</span>
<span class="sd">        ax</span>
<span class="sd">        figsize: tuple</span>
<span class="sd">        linestyle&#39;</span>
<span class="sd">        inverse :False,</span>
<span class="sd">            display 1/distance  instead of distance</span>
<span class="sd">        log : boolean</span>
<span class="sd">            display log for distance intead of distance</span>
<span class="sd">        gammma&#39;:1.,</span>
<span class="sd">            mulitplication factor for log : gamma*log(distance)</span>
<span class="sd">            this can be used to fit RSS</span>
<span class="sd">        mode : string</span>
<span class="sd">            &#39;HKB&#39; | &#39;TCR&#39; | &#39;FULL&#39;</span>
<span class="sd">        visi : boolean,</span>
<span class="sd">            display visibility</span>
<span class="sd">        color: string color (&#39;k&#39;|&#39;m&#39;|&#39;g&#39;),</span>
<span class="sd">            color to display the visibility area</span>
<span class="sd">        hatch&#39;: strin hatch type (&#39;//&#39;)</span>
<span class="sd">            hatch type to hatch visibility area</span>
<span class="sd">        fontsize: int</span>
<span class="sd">            title fontsize</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S=CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; S.pltgt(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;subject&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;t0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;t1&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
                     <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;inverse&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                     <span class="s1">&#39;log&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;gamma&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span>
                     <span class="s1">&#39;mode&#39;</span><span class="p">:</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;visi&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span>
                     <span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;hatch&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>




        <span class="c1">#t0 =kwargs.pop(&#39;t0&#39;)</span>
        <span class="c1">#t1 =kwargs.pop(&#39;t1&#39;)</span>
        <span class="c1">#if t1 ==-1:</span>
            <span class="c1">#t1=self.thkb[-1]</span>
        <span class="c1">#    t1=self.ttcr[-1]</span>


        <span class="n">label</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">)</span>
        <span class="n">inverse</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;inverse&#39;</span><span class="p">)</span>
        <span class="n">log</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">)</span>
        <span class="n">visibility</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;visi&#39;</span><span class="p">)</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fontsize&#39;</span><span class="p">)</span>
        <span class="n">hatch</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;hatch&#39;</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;subject&#39;</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">subject</span><span class="o">==</span><span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">subject</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">subject</span><span class="o">=</span><span class="n">subject</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">==</span><span class="p">[]:</span>
            <span class="n">figsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;figsize&#39;</span><span class="p">)</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;fig&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span><span class="p">[]:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>



        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;FULL&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">iahk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iahk</span> <span class="o">=</span> <span class="n">a</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">ibhk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ibhk</span> <span class="o">=</span> <span class="n">b</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlink</span><span class="p">(</span><span class="n">iahk</span><span class="p">,</span><span class="n">ibhk</span><span class="p">,</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>
            <span class="c1">#var = U.values</span>
            <span class="c1">#time = U.index</span>
            <span class="c1">#pdb.set_trace()</span>

            <span class="k">if</span> <span class="n">inverse</span><span class="p">:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">u&#39;$m^{-2}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span> <span class="p">:</span>
                    <span class="c1">#var = gamma*10*np.log10(var)</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="n">gamma</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">u&#39;$- 20 \log_{10}(d)&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">gamma</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;$  (dB)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">65</span><span class="p">,</span><span class="o">-</span><span class="mi">40</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">u&#39;meters&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">log</span> <span class="p">:</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="n">gamma</span><span class="o">*</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">var</span><span class="p">)</span><span class="o">+</span><span class="n">gamma</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">u&#39;$10log_{10}m^{-2}$&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>

            <span class="c1">#ax.plot(self.B[subject].time,var,label=label,**kwargs)</span>
            <span class="n">var</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
        <span class="c1">#</span>
        <span class="c1"># TCR |Full</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span> <span class="ow">or</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;FULL&#39;</span><span class="p">:</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">iatcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">iatcr</span> <span class="o">=</span> <span class="n">a</span>
                <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="n">ibtcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ibtcr</span> <span class="o">=</span> <span class="n">b</span>
                <span class="n">b</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>

            <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlink</span><span class="p">(</span><span class="n">iatcr</span><span class="p">,</span><span class="n">ibtcr</span><span class="p">,</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

            <span class="c1">#if inverse:</span>
            <span class="c1">#    var = 1./(var)**2</span>
            <span class="c1">#    if log :</span>
            <span class="c1">#        var = gamma*10*np.log10(var)</span>
            <span class="c1">#else:</span>
            <span class="c1">#    if log :</span>
            <span class="c1">#        var = gamma*10*np.log10(var)</span>

            <span class="c1">#pdb.set_trace()</span>
            <span class="c1">#ax.plot(self.B[subject].time,var,**kwargs)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">ttcr</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">visibility</span><span class="p">:</span>
            <span class="n">aa</span><span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">()</span>
            <span class="n">vv</span><span class="p">,</span><span class="n">tv</span><span class="p">,</span><span class="n">tseg</span><span class="p">,</span><span class="n">itseg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_visiarray</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
            <span class="c1"># vv.any : it exist NLOS regions</span>
            <span class="k">if</span> <span class="n">vv</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">plu</span><span class="o">.</span><span class="n">rectplot</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span><span class="n">tseg</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">aa</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span><span class="n">color</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span><span class="n">hatch</span><span class="o">=</span><span class="n">hatch</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                <span class="c1"># for t in tseg:</span>


        <span class="c1">#axs[cptax].plot(visi.index.values,visi.values,&#39;r&#39;)</span>


        <span class="c1">#if inverse:</span>
        <span class="c1">#    ax.set_title(u&#39;Motion Capture Ground Truth :  inverse of squared distance&#39;,fontsize=fontsize+1)</span>
        <span class="c1">#else:</span>
        <span class="c1">#    ax.set_title(&#39;Motion Capture Ground Truth : evolution of distance (m)&#39;,fontsize=fontsize+1)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>


    <span class="k">def</span> <span class="nf">pltlk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; plot links</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : string</span>
<span class="sd">            node a name</span>
<span class="sd">        b : string</span>
<span class="sd">            node b name</span>

<span class="sd">        display: list</span>
<span class="sd">            techno to be displayed</span>
<span class="sd">        figsize</span>
<span class="sd">        t0: float</span>
<span class="sd">            time start</span>
<span class="sd">        t1 : float</span>
<span class="sd">            time stop</span>
<span class="sd">        colhk: plt.color</span>

<span class="sd">            color of hk curve</span>
<span class="sd">        colhk2:plt.color</span>
<span class="sd">            color of hk curve2 ( if recirpocal)</span>
<span class="sd">        linestylehk:</span>
<span class="sd">            linestyle hk</span>

<span class="sd">        coltcr:</span>
<span class="sd">            color tcr curve</span>
<span class="sd">        coltcr2:</span>
<span class="sd">            color of tcr curve2 ( if recirpocal)</span>
<span class="sd">        linestyletcr:</span>
<span class="sd">            linestyle tcr</span>
<span class="sd">        colgt:</span>
<span class="sd">            color ground truth</span>
<span class="sd">        inversegt:</span>
<span class="sd">            invert ground truth</span>
<span class="sd">        loggt: bool</span>
<span class="sd">            apply a log10 factor to ground truth</span>
<span class="sd">        gammagt:</span>
<span class="sd">            applly a gamma factor to ground truth (if loggt ! )</span>
<span class="sd">        fontsize:</span>
<span class="sd">            font size of legend</span>
<span class="sd">        visi:</span>
<span class="sd">            display visibility indicator</span>
<span class="sd">        axs :</span>
<span class="sd">            list of matplotlib axes</span>

<span class="sd">        Example</span>
<span class="sd">        -------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S=CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; S.pltlk(&#39;AP1&#39;,&#39;TorsoTopLeft&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;display&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;figsize&#39;</span><span class="p">:(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span>
                     <span class="s1">&#39;t0&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;t1&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                     <span class="s1">&#39;colhk&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;colhk2&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;linestylehk&#39;</span><span class="p">:</span><span class="s1">&#39;default&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;coltcr&#39;</span><span class="p">:</span><span class="s1">&#39;g&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;coltcr2&#39;</span><span class="p">:</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;linestyletcr&#39;</span><span class="p">:</span><span class="s1">&#39;step&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;colgt&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;inversegt&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;loggt&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;gammagt&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">40</span><span class="p">,</span>
                     <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">14</span><span class="p">,</span>
                     <span class="s1">&#39;visi&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;axs&#39;</span> <span class="p">:[],</span>
                     <span class="s1">&#39;gt&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
                     <span class="s1">&#39;tit&#39;</span><span class="p">:</span><span class="s1">&#39;&#39;</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">display</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">display</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">display</span><span class="o">=</span><span class="p">[</span><span class="n">display</span><span class="p">]</span>


        <span class="k">if</span> <span class="n">display</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;tcr&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;hkb&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
                <span class="n">display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;FULL&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;tcr&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;TCR&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;hkb&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="n">display</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;HKB&#39;</span><span class="p">)</span>

        <span class="n">display</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">display</span><span class="p">]</span>

        <span class="k">if</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">ld</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">elif</span> <span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">display</span> <span class="ow">or</span> <span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="n">display</span><span class="p">:</span>
            <span class="n">ld</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="c1">#Axes management</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axs&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axs&#39;</span><span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">ld</span><span class="p">,</span><span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;figsize&#39;</span><span class="p">],</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
            <span class="n">axs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axs&#39;</span><span class="p">)</span>


        <span class="n">cptax</span><span class="o">=</span> <span class="mi">0</span>


        <span class="c1"># HKB plot</span>
        <span class="k">if</span> <span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="n">display</span> <span class="ow">or</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="n">display</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">iahk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;in self.pltlk, nodes id must be a string&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">ibhk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;in self.pltlk, nodes id must be a string&#39;</span><span class="p">)</span>

            <span class="k">else</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;HK not available for the given scenario&#39;</span><span class="p">)</span>






            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">cptax</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorab&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colhk&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorba&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colhk2&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linestylehk&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;tit&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tit&#39;</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span><span class="n">axs</span><span class="p">[</span><span class="n">cptax</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plthkb</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">reciprocal</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


            <span class="n">cptax</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colhk&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colhk2&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linestylehk&#39;</span><span class="p">)</span>


        <span class="c1">#TCR plot</span>
        <span class="k">if</span> <span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">display</span> <span class="ow">or</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="n">display</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">iatcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;in self.pltlk, nodes id must be a string&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                    <span class="n">ibtcr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
                <span class="k">else</span> <span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;in self.pltlk, nodes id must be a string&#39;</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;TCR not available for the given scenario&#39;</span><span class="p">)</span>

            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">cptax</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorab&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coltcr&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;colorba&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coltcr2&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linestyle&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linestyletcr&#39;</span><span class="p">)</span>
            <span class="n">tcrlink</span> <span class="o">=</span> <span class="n">a</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">b</span>
            <span class="c1">#plot only if link exist</span>
            <span class="k">if</span> <span class="n">tcrlink</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">axs</span><span class="p">[</span><span class="n">cptax</span><span class="p">]</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">plttcr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coltcr&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;coltcr2&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;linestyletcr&#39;</span><span class="p">)</span>
            <span class="c1">#cptax+=1</span>

        <span class="c1">#</span>
        <span class="c1"># Ground Truth</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1"># HKB |Full</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gt&#39;</span><span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colgt&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorab&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;colorba&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="n">cptax</span><span class="p">]</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;inverse&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;inversegt&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;loggt&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;gammagt&#39;</span><span class="p">)</span>
            <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tit&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="n">display</span> <span class="ow">or</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="n">display</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;HKB&#39;</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">axs</span><span class="p">[</span><span class="n">cptax</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltgt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">display</span> <span class="ow">or</span> <span class="s1">&#39;FULL&#39;</span> <span class="ow">in</span> <span class="n">display</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;mode&#39;</span><span class="p">]</span><span class="o">=</span> <span class="s1">&#39;TCR&#39;</span>
                <span class="n">fig</span><span class="p">,</span><span class="n">axs</span><span class="p">[</span><span class="n">cptax</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pltgt</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">axs</span>
        <span class="c1"># aa = axs[cptax].axis()</span>
        <span class="c1">#</span>
        <span class="c1"># calculates visibility and display NLOS region</span>
        <span class="c1"># as a yellow patch over the shadowed region</span>
        <span class="c1">#</span>


    <span class="k">def</span> <span class="nf">showpattern</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show pattern configuation for a given link and frame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : int</span>
<span class="sd">            link index</span>
<span class="sd">        technoa : string</span>
<span class="sd">            &#39;HKB&#39;|&#39;TCR&#39;|&#39;BS&#39;</span>
<span class="sd">        technob</span>
<span class="sd">            default &#39;HKB&#39;|&#39;TCR&#39;|&#39;BS&#39;</span>
<span class="sd">        phi : float</span>
<span class="sd">            antenna elevation in rad</span>
<span class="sd">        fig :</span>
<span class="sd">        ax  :</span>
<span class="sd">        t   : float</span>
<span class="sd">        phi : float</span>
<span class="sd">            pi/2</span>
<span class="sd">        ap  : boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;phi&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                     <span class="s1">&#39;ap&#39;</span><span class="p">:</span><span class="bp">False</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="c1"># display nodes</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="c1">#</span>
        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">subjecta</span><span class="p">,</span><span class="n">techno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">pa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getdevp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="n">techno</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">values</span>


        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pa</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">pa</span><span class="o">=</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ob&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">pa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pa</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ba</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">subjecta</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subjecta</span><span class="p">]</span><span class="o">.</span><span class="n">settopos</span><span class="p">(</span><span class="n">t</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subjecta</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="n">xa</span><span class="p">,</span><span class="n">ya</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subjecta</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_computemesh</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="n">pa</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subjecta</span><span class="p">]</span><span class="o">.</span><span class="n">acs</span><span class="p">[</span><span class="n">ba</span><span class="p">],</span><span class="n">minr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">maxr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ilog</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subjecta</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">phi</span><span class="o">&lt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># ax.plot(xa[:,p2],ya[:,p2])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xa</span><span class="p">[</span><span class="n">p2</span><span class="p">,:],</span><span class="n">ya</span><span class="p">[</span><span class="n">p2</span><span class="p">,:])</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
            <span class="n">xa</span><span class="p">,</span><span class="n">ya</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">sa</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">_computemesh</span><span class="p">(</span><span class="n">po</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">],</span><span class="n">T</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;T&#39;</span><span class="p">],</span><span class="n">minr</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">maxr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">ilog</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">ba</span><span class="p">][</span><span class="s1">&#39;ant&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">phi</span><span class="o">&lt;=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;phi&#39;</span><span class="p">])[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xa</span><span class="p">[:,</span><span class="n">p2</span><span class="p">],</span><span class="n">ya</span><span class="p">[:,</span><span class="n">p2</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span>

    <span class="k">def</span> <span class="nf">showlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="s1">&#39;AP1&#39;</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s1">&#39;BackCenter&#39;</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; show link configuation for a given frame</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : int</span>
<span class="sd">            link index</span>
<span class="sd">        b : int</span>
<span class="sd">            link index</span>
<span class="sd">        technoa : string</span>
<span class="sd">            default &#39;HKB&#39;|&#39;TCR&#39;|&#39;BS&#39;</span>
<span class="sd">        technob</span>
<span class="sd">            default &#39;HKB&#39;|&#39;TCR&#39;|&#39;BS&#39;</span>
<span class="sd">        phi : float</span>
<span class="sd">            antenna elevation in rad</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fig&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;ax&#39;</span><span class="p">:[],</span>
                     <span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
                     <span class="s1">&#39;phi&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>
                     <span class="s1">&#39;ap&#39;</span><span class="p">:</span><span class="bp">False</span>
                    <span class="p">}</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaults</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fig&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>

        <span class="c1"># display nodes</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">showpattern</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="n">technoa</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">showpattern</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="n">technob</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>


        <span class="n">p1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="s1">&#39;HKB:1&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="s1">&#39;HKB:2&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="s1">&#39;HKB:3&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">p4</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="s1">&#39;HKB:4&#39;</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;og&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ob&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p3</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;or&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p4</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">p4</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;ok&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
        
        <span class="c1"># if A.ndim==2:</span>
        <span class="c1">#     plt.plot(A[iframe,0],A[iframe,1],&#39;ob&#39;)</span>
        <span class="c1">#     plt.text(A[iframe,0],A[iframe,1],a)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     plt.plot(A[0],A[1],&#39;or&#39;)</span>
        <span class="c1">#     #plt.text(A[0],A[1],a)</span>

        <span class="c1"># if B.ndim==2:</span>
        <span class="c1">#     plt.plot(B[iframe,0],B[iframe,1],style)</span>
        <span class="c1">#     plt.text(B[iframe,0]+0.1,B[iframe,1]+0.1,b)</span>
        <span class="c1"># else:</span>
        <span class="c1">#     plt.plot(B[0],B[1],&#39;ob&#39;)</span>
        <span class="c1">#     plt.text(B[0],B[1],b)</span>
        <span class="c1"># plt.xlim(-6,6)</span>
        <span class="c1"># plt.ylim(-5,5)</span>


        <span class="c1"># self.B[subjecta].settopos(t=t)</span>
        <span class="c1"># self.B[subjectb].settopos(t=t)</span>

        <span class="c1"># </span>

        
        <span class="c1"># # display body</span>

        <span class="c1"># #pc = self.B.d[:,2,iframe] + self.B.pg[:,iframe].T</span>
        <span class="c1"># pc0 = self.B[subjecta].d[:,0,iframe] + self.B[subjecta].pg[:,iframe].T</span>
        <span class="c1"># pc1 = self.B[subjecta].d[:,1,iframe] + self.B[subjecta].pg[:,iframe].T</span>
        <span class="c1"># pc15 = self.B[subjecta].d[:,15,iframe] + self.B[subjecta].pg[:,iframe].T</span>
        <span class="c1"># #plt.plot(pc0[0],pc0[1],&#39;og&#39;)</span>
        <span class="c1"># #plt.text(pc0[0]+0.1,pc0[1],str(iframe))</span>
        <span class="c1"># #plt.plot(pc1[0],pc1[1],&#39;og&#39;)</span>
        <span class="c1"># #plt.plot(pc15[0],pc15[1],&#39;og&#39;)</span>
        <span class="c1"># #ci00   = plt.Circle((pc0[0],pc0[1]),self.B[subjecta].sl[0,2],color=&#39;green&#39;,alpha=0.6)</span>
        <span class="c1"># #ci01   = plt.Circle((pc1[0],pc1[1]),self.B[subjecta].sl[0,2],color=&#39;green&#39;,alpha=0.1)</span>
        <span class="c1"># #ci100 = plt.Circle((pc0[0],pc0[1]),self.B[subjecta].sl[10,2],color=&#39;red&#39;,alpha=0.1)</span>
        <span class="c1"># ci1015 = plt.Circle((pc15[0],pc15[1]),self.B[subjecta].sl[10,2],color=&#39;green&#39;,alpha=0.5)</span>
        <span class="c1"># plt.axis(&#39;equal&#39;)</span>
        <span class="c1"># ax = plt.gca()</span>
        <span class="c1"># ax.add_patch(ci1015)</span>
        <span class="c1"># #ax.add_patch(ci01)</span>
        <span class="c1"># #ax.add_patch(ci100)</span>
        <span class="c1"># #ax.add_patch(ci1015)</span>
        <span class="c1"># #its = self.B[subjecta].intersectBody(A[iframe,:],B[iframe,:],topos=False,frameId=iframe)</span>
        <span class="c1"># #x.set_title(&#39;frameId :&#39;+str(iframe)+&#39; &#39;+str(its.T))</span>



<div class="viewcode-block" id="CorSer.visidev"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.visidev.html#pylayers.measures.cormoran.CorSer.visidev">[docs]</a>    <span class="k">def</span> <span class="nf">visidev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">dsf</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get link visibility status</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        visi : pandas Series</span>
<span class="sd">            0  : LOS</span>
<span class="sd">            1  : NLOS</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlinkp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="n">technoa</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="n">technob</span><span class="p">)</span>
        <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">values</span>
        <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="o">.</span><span class="n">values</span>
        <span class="n">aa</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">subjecta</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">technoa</span><span class="p">)</span>
        <span class="n">ab</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">subjectb</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">technob</span><span class="p">)</span>


        <span class="k">if</span> <span class="s1">&#39;AP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">aa</span><span class="p">:</span>
            <span class="n">Nframe</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;AP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ab</span><span class="p">:</span>
            <span class="n">Nframe</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">Nframe</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
        <span class="n">iframe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nframe</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dsf</span><span class="p">)</span>
        <span class="n">tvisi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#</span>
        <span class="c1"># A : Nframe x 3</span>
        <span class="c1"># B : Nframe x 3</span>
        <span class="c1"># B.pg : 3 x Nframe</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">subjecta</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">subjecta</span>
        <span class="k">elif</span> <span class="n">subjectb</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">subjectb</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visibility can only be determine on a body for now&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">centered</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">pg</span><span class="o">.</span><span class="n">T</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">pg</span><span class="o">.</span><span class="n">T</span>


        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">iframe</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">A</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">B</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">B</span><span class="p">))</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">:</span>
                <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,:]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span>

            <span class="n">its</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">intersectBody</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">k</span><span class="p">,:],</span><span class="n">B</span><span class="p">[</span><span class="n">k</span><span class="p">,:],</span><span class="n">topos</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">frameId</span><span class="o">=</span><span class="n">k</span><span class="p">)</span>
            <span class="n">tvisi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">its</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>
        <span class="n">visi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tvisi</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">iframe</span><span class="o">/</span><span class="mf">100.</span><span class="p">)</span>
        <span class="c1">#return(visi,iframe)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">visi</span><span class="p">)</span></div>

<div class="viewcode-block" id="CorSer.visidev2"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.visidev2.html#pylayers.measures.cormoran.CorSer.visidev2">[docs]</a>    <span class="k">def</span> <span class="nf">visidev2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">trange</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&quot;&quot;&quot; get link visibility status</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        trange : nd array</span>
<span class="sd">            time range</span>
<span class="sd">        visi : pandas Series</span>
<span class="sd">            0  : LOS</span>
<span class="sd">            1  : NLOS</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getlinkp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">technoa</span><span class="p">,</span><span class="n">technob</span><span class="p">)</span>
        <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="o">.</span><span class="n">values</span>
        <span class="n">B</span><span class="o">=</span><span class="n">B</span><span class="o">.</span><span class="n">values</span>
        <span class="n">aa</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">subjecta</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">technoa</span><span class="p">)</span>
        <span class="n">ab</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">bb</span><span class="p">,</span><span class="n">subjectb</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">technob</span><span class="p">)</span>

        <span class="k">if</span> <span class="s1">&#39;AP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
            <span class="n">Nframe</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;AP&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
            <span class="n">Nframe</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># iframe = np.arange(0,Nframe-1,dsf)</span>
        <span class="n">tvisi</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#</span>
        <span class="c1"># A : Nframe x 3</span>
        <span class="c1"># B : Nframe x 3</span>
        <span class="c1"># B.pg : 3 x Nframe</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">subjecta</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">subjecta</span>
        <span class="k">elif</span> <span class="n">subjectb</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">subjectb</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Visibility can only be determine on a body for now&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">centered</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">pg</span><span class="o">.</span><span class="n">T</span>
            <span class="n">B</span> <span class="o">=</span> <span class="n">B</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">pg</span><span class="o">.</span><span class="n">T</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">trange</span><span class="p">:</span>
            <span class="n">fid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">posvel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subjecta</span><span class="p">]</span><span class="o">.</span><span class="n">traj</span><span class="p">,</span><span class="n">t</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">its</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">subject</span><span class="p">]</span><span class="o">.</span><span class="n">intersectBody</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="n">fid</span><span class="p">,:],</span><span class="n">B</span><span class="p">[</span><span class="n">fid</span><span class="p">,:],</span><span class="n">topos</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">frameId</span><span class="o">=</span><span class="n">fid</span><span class="p">)</span>
            <span class="n">tvisi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">its</span><span class="o">.</span><span class="n">any</span><span class="p">())</span>
        <span class="n">visi</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">tvisi</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">trange</span><span class="p">)</span>
        <span class="c1">#return(visi,iframe)</span>
        <span class="k">return</span><span class="p">(</span><span class="n">visi</span><span class="p">)</span></div>



<div class="viewcode-block" id="CorSer._visiarray"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._visiarray.html#pylayers.measures.cormoran.CorSer._visiarray">[docs]</a>    <span class="k">def</span> <span class="nf">_visiarray</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="s1">&#39;HKB&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create entries for plu.rectplot</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">visi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">visidev</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="n">technoa</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="n">technob</span><span class="p">)</span>
        <span class="n">tv</span> <span class="o">=</span> <span class="n">visi</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
        <span class="n">vv</span> <span class="o">=</span> <span class="n">visi</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span><span class="p">(</span><span class="n">vv</span><span class="o">.</span><span class="n">all</span><span class="p">())</span> <span class="ow">and</span> <span class="n">vv</span><span class="o">.</span><span class="n">any</span><span class="p">()):</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">vv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">-</span><span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">==</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">df</span><span class="o">==-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">um</span><span class="p">)</span>
            <span class="n">lud</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ud</span><span class="p">)</span>

            <span class="c1">#</span>
            <span class="c1"># impose same size and starting</span>
            <span class="c1"># on leading edge um and endinf on</span>
            <span class="c1"># falling edge ud</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="n">lum</span><span class="o">==</span><span class="n">lud</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ud</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">um</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">um</span><span class="p">))</span>
                    <span class="n">ud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ud</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">lum</span><span class="o">&lt;</span><span class="n">lud</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="n">um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">um</span><span class="p">))</span>

                <span class="k">if</span> <span class="p">((</span><span class="n">lud</span><span class="o">&lt;</span><span class="n">lum</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">vv</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)):</span>
                    <span class="n">ud</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">ud</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>


            <span class="n">tseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">um</span><span class="p">,</span><span class="n">ud</span><span class="p">))</span>
            <span class="c1">#else:</span>
            <span class="c1">#    tseg = np.array(zip(ud,um))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">vv</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">tseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="n">tseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]])</span>
        <span class="n">itseg</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">tseg</span><span class="p">)</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">itseg</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">itseg</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">vv</span><span class="p">)))</span>
        <span class="n">itseg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">bb</span><span class="p">,</span><span class="n">ee</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="c1"># bb = np.hstack((bb,len(vv)))</span>

        <span class="k">return</span> <span class="n">vv</span><span class="p">,</span><span class="n">tv</span><span class="p">,</span><span class="n">tseg</span><span class="p">,</span><span class="n">itseg</span></div>


    <span class="c1"># def _computedevpdf(self):</span>
    <span class="c1">#     &quot;&quot;&quot; create a timestamped data frame</span>
    <span class="c1">#         with all positions of devices</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     t=self.B.traj.time()</span>
    <span class="c1">#     pos = np.empty((len(t),12,3))</span>
    <span class="c1">#     for ik,k in enumerate(t):</span>
    <span class="c1">#         self.B.settopos(t=k)</span>
    <span class="c1">#         pos[ik,:,:]=self.B.getlinkp()</span>
    <span class="c1">#     df=[]</span>
    <span class="c1">#     for d in range(pos.shape[1]):</span>
    <span class="c1">#         df_tmp=pd.DataFrame(pos[:,d,:],columns=[&#39;x&#39;,&#39;y&#39;,&#39;z&#39;],index=t)</span>
    <span class="c1">#         df_tmp[&#39;id&#39;]=self.B.dev.keys()[d]</span>
    <span class="c1">#         try :</span>
    <span class="c1">#             df = pd.concat([df,df_tmp])</span>
    <span class="c1">#         except:</span>
    <span class="c1">#             df = df_tmp</span>
    <span class="c1">#     df = df.sort_index()</span>
    <span class="c1">#     cols=[&#39;id&#39;,&#39;x&#39;,&#39;y&#39;,&#39;z&#39;]</span>
    <span class="c1">#     self.devdf=df[cols]</span>

<div class="viewcode-block" id="CorSer._computedevpdf"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._computedevpdf.html#pylayers.measures.cormoran.CorSer._computedevpdf">[docs]</a>    <span class="k">def</span> <span class="nf">_computedevpdf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; create a timestamped data frame</span>
<span class="sd">            with positions of all devices</span>


<span class="sd">        &quot;&quot;&quot;</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span>
            <span class="n">B</span><span class="o">=</span><span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">subject</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">}</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">B</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span>

        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">B</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;dev&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]):</span>
                <span class="n">dev</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">udev</span><span class="o">=</span><span class="p">[</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;uc3d&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dev</span><span class="p">]</span>

                <span class="n">postmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">_f</span><span class="p">[:,</span><span class="n">u</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">udev</span><span class="p">])</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">postmp</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">time</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dev</span><span class="p">)):</span>
                    <span class="n">df_tmp</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pos</span><span class="p">[:,</span><span class="n">d</span><span class="p">,:],</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">df_tmp</span><span class="p">[[</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">]]</span><span class="o">=</span><span class="n">df_tmp</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[[</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">df_tmp</span><span class="p">[[</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="s1">&#39;az&#39;</span><span class="p">]]</span><span class="o">=</span><span class="n">df_tmp</span><span class="p">[[</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">df_tmp</span><span class="p">[[</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="s1">&#39;az&#39;</span><span class="p">]]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">d</span><span class="p">]</span>
                    <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">name</span>
                    <span class="k">try</span> <span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">df_tmp</span><span class="p">])</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">df</span> <span class="o">=</span> <span class="n">df_tmp</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">din</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
            <span class="n">pos2</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            <span class="n">df_tmp</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pos2</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;vx&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;vy&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;vz&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;ay&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;az&#39;</span><span class="p">]</span><span class="o">=</span><span class="mf">0.</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">=</span><span class="s1">&#39;&#39;</span>
            <span class="n">df_tmp</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">i</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">df_tmp</span><span class="p">])</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="s1">&#39;az&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span></div>

        <span class="c1"># if (&#39;HKB&#39; in self.typ) or (&#39;FULL&#39; in selftyp):</span>
        <span class="c1">#     self.devdf=self._align_devdf_on_hkb(self.devdf,self.hkb)</span>


<div class="viewcode-block" id="CorSer.export_csv"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.export_csv.html#pylayers.measures.cormoran.CorSer.export_csv">[docs]</a>    <span class="k">def</span> <span class="nf">export_csv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; export to csv devices positions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            unit : string (&#39;mm&#39;|&#39;cm&#39;|&#39;m&#39;),</span>
<span class="sd">                unit of positions in csv(default mm)</span>
<span class="sd">            tunit: string</span>
<span class="sd">                time unit in csv (default &#39;ns&#39;)</span>
<span class="sd">            &#39;alias&#39;: dict</span>
<span class="sd">                dictionnary to replace name of the devices into the csv .</span>
<span class="sd">                example : if you want to replace a device id named &#39;TCR:34&#39;</span>
<span class="sd">                to an id = 5, you have to add an entry in the alias dictionnary as :</span>
<span class="sd">                alias.update({&#39;TCR34&#39;:5})</span>
<span class="sd">            offset : np.array</span>
<span class="sd">                apply an offset on positions</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>

<span class="sd">            a csv file into the folder &lt;PylayersProject&gt;/netsave</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;unit&#39;</span> <span class="p">:</span><span class="s1">&#39;mm&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;tunit&#39;</span><span class="p">:</span><span class="s1">&#39;ns&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;offset&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])),</span>
                  <span class="s1">&#39;alias&#39;</span><span class="p">:{}}</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">defaults</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">unit</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;unit&#39;</span><span class="p">)</span>
        <span class="n">tunit</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;tunit&#39;</span><span class="p">)</span>
        <span class="n">alias</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;alias&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">alias</span> <span class="o">==</span> <span class="p">{}:</span>

            <span class="n">alias</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;TCR:49&#39;</span><span class="p">:</span><span class="mi">4</span> <span class="c1">#Nicolas TorsoLeft</span>
            <span class="p">,</span><span class="s1">&#39;TCR:34&#39;</span><span class="p">:</span><span class="mi">5</span> <span class="c1">#Nicolas TorsoRight</span>
            <span class="p">,</span><span class="s1">&#39;TCR:48&#39;</span><span class="p">:</span><span class="mi">6</span> <span class="c1">#Nicolas Back</span>
            <span class="p">,</span><span class="s1">&#39;TCR:36&#39;</span><span class="p">:</span><span class="mi">7</span> <span class="c1">#Nicolas Shoulder</span>

            <span class="p">,</span><span class="s1">&#39;TCR:2&#39;</span><span class="p">:</span><span class="mi">8</span> <span class="c1"># Jihad TorsoLeft</span>
            <span class="p">,</span><span class="s1">&#39;TCR:35&#39;</span><span class="p">:</span><span class="mi">9</span> <span class="c1">#Jihad TorsoRight</span>
            <span class="p">,</span><span class="s1">&#39;TCR:33&#39;</span><span class="p">:</span><span class="mi">10</span> <span class="c1">#Jihad Back</span>
            <span class="p">,</span><span class="s1">&#39;TCR:37&#39;</span><span class="p">:</span><span class="mi">11</span> <span class="c1">#Jihad Shoulder</span>

            <span class="p">,</span><span class="s1">&#39;TCR:30&#39;</span><span class="p">:</span><span class="mi">12</span> <span class="c1">#Eric Torso</span>
            <span class="p">,</span><span class="s1">&#39;TCR:25&#39;</span><span class="p">:</span><span class="mi">13</span> <span class="c1">#Eric Back</span>
            <span class="p">,</span><span class="s1">&#39;TCR:26&#39;</span><span class="p">:</span><span class="mi">14</span> <span class="c1"># Eric Shoulder</span>
            <span class="p">}</span>

        <span class="n">filename</span> <span class="o">=</span><span class="n">pyu</span><span class="o">.</span><span class="n">getlong</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">,</span><span class="n">pstruc</span><span class="p">[</span><span class="s1">&#39;DIRNETSAVE&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">)</span>

        <span class="n">ldf</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]]</span>

        <span class="c1">#rename devices</span>
        <span class="k">if</span> <span class="n">alias</span> <span class="o">!=</span> <span class="p">{}:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">alias</span><span class="p">:</span>
                <span class="n">u</span><span class="o">=</span><span class="n">ldf</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span>
                <span class="n">ldf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">u</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">alias</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>

        <span class="c1"># fix position unit</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">_unit</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;cm&#39;</span><span class="p">:</span>
            <span class="n">_unit</span> <span class="o">=</span> <span class="mf">1e2</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="o">==</span> <span class="s1">&#39;mm&#39;</span><span class="p">:</span>
            <span class="n">_unit</span> <span class="o">=</span> <span class="mf">1e3</span>

        <span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">_unit</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">_unit</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ldf</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">_unit</span><span class="o">-</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># fix time unit</span>
        <span class="k">if</span> <span class="n">tunit</span> <span class="o">==</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span>
            <span class="n">_tunit</span> <span class="o">=</span> <span class="mf">1e3</span>
        <span class="k">if</span> <span class="n">tunit</span> <span class="o">==</span> <span class="s1">&#39;us&#39;</span><span class="p">:</span>
            <span class="n">_tunit</span> <span class="o">=</span> <span class="mf">1e6</span>
        <span class="k">if</span> <span class="n">tunit</span> <span class="o">==</span> <span class="s1">&#39;ns&#39;</span><span class="p">:</span>
            <span class="n">_tunit</span> <span class="o">=</span> <span class="mf">1e9</span>


        <span class="c1"># add timestamp column</span>

        <span class="n">ldf</span><span class="p">[</span><span class="s1">&#39;Timestamp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ldf</span><span class="o">.</span><span class="n">index</span><span class="o">*</span><span class="n">_tunit</span>

        <span class="n">ldf</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span></div>


<div class="viewcode-block" id="CorSer.getlinkd"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.getlinkd.html#pylayers.measures.cormoran.CorSer.getlinkd">[docs]</a>    <span class="k">def</span> <span class="nf">getlinkd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;    get the distance for a link between devices</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : str | int</span>
<span class="sd">            name |id</span>
<span class="sd">        b : str | int</span>
<span class="sd">            name |id</span>

<span class="sd">        optional</span>

<span class="sd">        techno : str</span>
<span class="sd">            radio techno</span>

<span class="sd">        t : float | list</span>
<span class="sd">            given time</span>
<span class="sd">            or [start,stop] time</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        dist : np.array()</span>
<span class="sd">            all distances for all timestamps for the given link</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S = CorSer(serie=6)</span>
<span class="sd">        &gt;&gt;&gt; d = S.getlinkd(&#39;AP1&#39;,&#39;WristLeft&#39;,techno=&#39;HKB&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">ra</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">rb</span> <span class="o">=</span> <span class="n">b</span>

        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">nna</span><span class="p">,</span><span class="n">subjecta</span><span class="p">,</span><span class="n">techno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">nnb</span><span class="p">,</span><span class="n">subjectb</span><span class="p">,</span><span class="n">techno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>


        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distdf</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">nna</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">nnb</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">distdf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">nna</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">nnb</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">nnb</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">nna</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">distdf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">link</span> <span class="o">=</span> <span class="n">nnb</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">nna</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Link between &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; and &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rb</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is not available in distdf dataframe&#39;</span><span class="p">)</span>

        <span class="c1">#determine time</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">tstart</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tstop</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">tstart</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">tstop</span><span class="p">)][</span><span class="n">link</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">link</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">hstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">hstep</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">+</span><span class="n">hstep</span><span class="p">)][</span><span class="n">link</span><span class="p">]</span>



        <span class="k">return</span> <span class="n">val</span></div>



<div class="viewcode-block" id="CorSer.getlinkp"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.getlinkp.html#pylayers.measures.cormoran.CorSer.getlinkp">[docs]</a>    <span class="k">def</span> <span class="nf">getlinkp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">technoa</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">technob</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">fId</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;    get a link devices positions</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : str | int</span>
<span class="sd">            name |id</span>
<span class="sd">        b : str | int</span>
<span class="sd">            name |id</span>


<span class="sd">        optional :</span>

<span class="sd">        technoa : str</span>
<span class="sd">            radio techno</span>
<span class="sd">        technob : str</span>
<span class="sd">            radio techno</span>

<span class="sd">        t : float | list</span>
<span class="sd">            given time | [time_start,time_stop]</span>

<span class="sd">        OR </span>

<span class="sd">        fId : int</span>
<span class="sd">            frame id</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        pa,pb : np.array()</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S=CorSer(serie=34)</span>
<span class="sd">        &gt;&gt;&gt; a,b=S.getlinkp(&#39;AP1&#39;,&#39;WristLeft&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">pa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getdevp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">technoa</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">fId</span><span class="p">)</span>
        <span class="n">pb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getdevp</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">technob</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">fId</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pa</span><span class="p">,</span><span class="n">pb</span></div>


<div class="viewcode-block" id="CorSer.getlink"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.getlink.html#pylayers.measures.cormoran.CorSer.getlink">[docs]</a>    <span class="k">def</span> <span class="nf">getlink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;    get a link value</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : str | int</span>
<span class="sd">            name |id</span>
<span class="sd">        b : str | int</span>
<span class="sd">            name |id</span>


<span class="sd">        optional :</span>


<span class="sd">        techno : str</span>
<span class="sd">            radio techno</span>

<span class="sd">        t : float | list</span>
<span class="sd">            given time</span>
<span class="sd">            or [start,stop] time</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        Pandas Serie</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S=CorSer(serie=34)</span>
<span class="sd">        &gt;&gt;&gt; S.getlink(&#39;AP1&#39;,&#39;WristLeft&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>



        <span class="n">ra</span> <span class="o">=</span> <span class="n">a</span>
        <span class="n">rb</span> <span class="o">=</span> <span class="n">b</span>
        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">nna</span><span class="p">,</span><span class="n">subjecta</span><span class="p">,</span><span class="n">techno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>
        <span class="n">b</span><span class="p">,</span><span class="n">ib</span><span class="p">,</span><span class="n">nnb</span><span class="p">,</span><span class="n">subjectb</span><span class="p">,</span><span class="n">techno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HK&#39;</span> <span class="ow">in</span> <span class="n">techno</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">b</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">a</span>
            <span class="k">else</span> <span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Link between &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; and &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rb</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is not available in hkb dataframe&#39;</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="n">techno</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">b</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">a</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Link between &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; and &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rb</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is not available in bespo dataframe&#39;</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span>

        <span class="k">elif</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">techno</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">b</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">b</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">link</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span><span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="n">a</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Link between &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span> <span class="o">+</span><span class="s1">&#39; and &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rb</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; is not available in tcr dataframe&#39;</span><span class="p">)</span>

            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span>


        <span class="c1">#determine time</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">tstart</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tstop</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">tstart</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">tstop</span><span class="p">)][</span><span class="n">link</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">link</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">hstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">hstep</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">+</span><span class="n">hstep</span><span class="p">)][</span><span class="n">link</span><span class="p">]</span>


        <span class="k">return</span> <span class="n">val</span></div>



<div class="viewcode-block" id="CorSer.getdevp"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.getdevp.html#pylayers.measures.cormoran.CorSer.getdevp">[docs]</a>    <span class="k">def</span> <span class="nf">getdevp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">fId</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; get a  device position</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : str | int</span>
<span class="sd">            name |id</span>
<span class="sd">        techno : str</span>
<span class="sd">            radio techno</span>

<span class="sd">        optional :</span>

<span class="sd">        t : float | list</span>
<span class="sd">            given time |[time_start,time_stop]</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        pa : np.array()</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S=CorSer(serie=34)</span>
<span class="sd">        &gt;&gt;&gt; a=S.getdevp(&#39;AP1&#39;,&#39;WristLeft&#39;)</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">nna</span><span class="p">,</span><span class="n">subjecta</span><span class="p">,</span><span class="n">techno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devmapper</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="p">)</span>

        <span class="n">device_select</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">nna</span>


        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">tstart</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">tstop</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1">#findex = np.where((self.tmocap&gt;=tstart) &amp; (self.tmocap&lt;=tstop))[0]</span>


        <span class="k">elif</span> <span class="n">t</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">tstart</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">tstop</span> <span class="o">=</span> <span class="mi">1000000</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="n">hstep</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">[</span><span class="n">device_select</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">[</span><span class="n">device_select</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>
            <span class="n">tstart</span> <span class="o">=</span> <span class="n">t</span><span class="o">-</span><span class="n">hstep</span>
            <span class="n">tstop</span> <span class="o">=</span> <span class="n">t</span><span class="o">+</span><span class="n">hstep</span>


        <span class="n">pa</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">tstart</span><span class="p">)</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devdf</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;=</span> <span class="n">tstop</span><span class="p">)</span> <span class="o">&amp;</span>
                        <span class="n">device_select</span><span class="p">][[</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">pa</span></div>




<div class="viewcode-block" id="CorSer.devmapper"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.devmapper.html#pylayers.measures.cormoran.CorSer.devmapper">[docs]</a>    <span class="k">def</span> <span class="nf">devmapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">techno</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  retrieve name of device if input is number</span>
<span class="sd">             or</span>
<span class="sd">             retrieve number of device if input is name</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        a : str | int</span>
<span class="sd">            name |id |bodyid</span>
<span class="sd">        techno : str</span>
<span class="sd">            radio techno</span>


<span class="sd">        Returns</span>
<span class="sd">        -------</span>

<span class="sd">        a : string</span>
<span class="sd">            dev name</span>
<span class="sd">        ia : int</span>
<span class="sd">            dev number</span>
<span class="sd">        ba : string</span>
<span class="sd">            dev refernce in body</span>
<span class="sd">        subject : string</span>
<span class="sd">            body owning the device</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">subject</span><span class="o">=</span><span class="s1">&#39;&#39;</span>

        <span class="c1">#if a is a bodyid (e.g. &#39;HKB:16&#39;) or a body part (e.g. AnkleRight)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="c1"># case where body id is given as input</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;HKB&#39;</span> <span class="ow">in</span> <span class="n">a</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;TCR&#39;</span> <span class="ow">in</span> <span class="n">a</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s1">&#39;BS&#39;</span> <span class="ow">in</span> <span class="n">a</span> <span class="p">)</span> <span class="p">:</span>

                <span class="n">ba</span> <span class="o">=</span> <span class="n">a</span>
                <span class="n">techno</span><span class="p">,</span> <span class="n">ia</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
                <span class="n">ia</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">):</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;BS&#39;</span><span class="p">):</span>
                        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idBS</span><span class="p">[</span><span class="n">ia</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No device &#39;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s1">&#39; for techno &#39;</span> <span class="o">+</span><span class="n">techno</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Cylindre&#39;</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ba</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">subject</span> <span class="o">=</span> <span class="n">b</span>
                            <span class="k">break</span>

            <span class="c1">#case where body part (e.g. AnkleRight) is given. Here techno is mandatory</span>
            <span class="k">else</span> <span class="p">:</span>

                <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">!=</span> <span class="s1">&#39;FULL&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;HKBS&#39;</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Please indicate the radio techno in argument : HKB or BS&#39;</span><span class="p">)</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="n">techno</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Please indicate the radio techno in argument : TCR, HKB, BS&#39;</span><span class="p">)</span>


                <span class="k">try</span> <span class="p">:</span>
                    <span class="k">if</span> <span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
                        <span class="n">ia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dTCR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                        <span class="n">ba</span><span class="o">=</span><span class="s1">&#39;TCR:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">)</span> <span class="p">:</span>
                        <span class="n">ia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dHKB</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                        <span class="n">ba</span><span class="o">=</span><span class="s1">&#39;HKB:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;BS&#39;</span><span class="p">:</span>
                        <span class="n">ia</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dBS</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                        <span class="n">ba</span><span class="o">=</span><span class="s1">&#39;BS:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No device on body part: &#39;</span> <span class="o">+</span> <span class="n">a</span> <span class="o">+</span> <span class="s1">&#39; for techno &#39;</span> <span class="o">+</span><span class="n">techno</span><span class="p">)</span>


                <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Cylindre&#39;</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">ba</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                            <span class="n">subject</span> <span class="o">=</span> <span class="n">b</span>
                            <span class="k">break</span>

        <span class="c1"># an id (number) is given</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># techno autodetection raise an error if conflict and invite to precise radio techno</span>
            <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;idHKB&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">:</span>
                        <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="n">techno</span> <span class="o">=</span> <span class="s1">&#39;HKB&#39;</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Please indicate the radio techno in argument : TCR, HKB, BS&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;idBS&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idBS</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="n">techno</span> <span class="o">=</span> <span class="s1">&#39;BS&#39;</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Please indicate the radio techno in argument : TCR, HKB, BS&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;idTCR&#39;</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="n">techno</span> <span class="o">=</span> <span class="s1">&#39;TCR&#39;</span>
                        <span class="k">else</span> <span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Please indicate the radio techno in argument : TCR, HKB, BS&#39;</span><span class="p">)</span>

            <span class="k">try</span> <span class="p">:</span>
                <span class="k">if</span> <span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
                    <span class="n">ia</span> <span class="o">=</span> <span class="n">a</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idTCR</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                    <span class="n">ba</span><span class="o">=</span><span class="s1">&#39;TCR:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">ia</span> <span class="o">=</span> <span class="n">a</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idHKB</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                    <span class="n">ba</span><span class="o">=</span><span class="s1">&#39;HKB:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>

                <span class="k">elif</span> <span class="p">(</span><span class="n">techno</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;BS&#39;</span><span class="p">)</span> <span class="p">:</span>
                    <span class="n">ia</span> <span class="o">=</span> <span class="n">a</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idBS</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
                    <span class="n">ba</span><span class="o">=</span><span class="s1">&#39;BS:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ia</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;No device with ID: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; for techno &#39;</span> <span class="o">+</span><span class="n">techno</span><span class="p">)</span>


            <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Cylindre&#39;</span> <span class="ow">in</span> <span class="n">b</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ba</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">dev</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                        <span class="n">subject</span> <span class="o">=</span> <span class="n">b</span>
                        <span class="k">break</span>

        <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">ia</span><span class="p">,</span><span class="n">ba</span><span class="p">,</span><span class="n">subject</span><span class="p">,</span><span class="n">techno</span></div>


<div class="viewcode-block" id="CorSer.align"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer.align.html#pylayers.measures.cormoran.CorSer.align">[docs]</a>    <span class="k">def</span> <span class="nf">align</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">devdf</span><span class="p">,</span><span class="n">hkbdf</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot; DEPRECATED align time of 2 data frames:</span>

<span class="sd">        the time delta of the second data frame is applyied on the first one</span>
<span class="sd">        (e.g. time for devdf donwsampled by hkb data frame time)</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        devdf : device dataframe</span>
<span class="sd">        hkbdf : hkbdataframe</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>

<span class="sd">        devdfc : </span>
<span class="sd">            aligned copy device dataframe</span>
<span class="sd">        hkbdfc : </span>
<span class="sd">            aligned copy hkbdataframe</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S=CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; devdf = S.devdf[S.devdf[&#39;id&#39;]==&#39;HKB:15&#39;]</span>
<span class="sd">        &gt;&gt;&gt; hkbdf = S.hkb[&#39;AP1-AnkleLeft&#39;]</span>
<span class="sd">        &gt;&gt;&gt; devdf2,hkbdf2 = S.align(devdf,hkbdf)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">print</span> <span class="p">(</span><span class="s1">&#39;warning DEPRECATED&#39;</span><span class="p">)</span>

        <span class="n">devdfc</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">devdf</span><span class="p">)</span>
        <span class="n">hkbdfc</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">hkbdf</span><span class="p">)</span>
        <span class="n">idev</span> <span class="o">=</span> <span class="n">devdfc</span><span class="o">.</span><span class="n">index</span>
        <span class="n">ihkb</span> <span class="o">=</span> <span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span>

        <span class="n">devdfc</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idev</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ihkb</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="kn">import</span> <span class="nn">ipdb</span>
        <span class="n">ipdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="p">(</span><span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">microseconds</span>
        <span class="n">devdfc</span><span class="o">=</span> <span class="n">devdfc</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;U&#39;</span><span class="p">)</span>

        <span class="n">devdfc</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">devdfc</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
        <span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">val</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">devdfc</span><span class="p">,</span><span class="n">hkbdfc</span></div>


<div class="viewcode-block" id="CorSer._apply_offset"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._apply_offset.html#pylayers.measures.cormoran.CorSer._apply_offset">[docs]</a>    <span class="k">def</span> <span class="nf">_apply_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">techno</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply offset from self.offset[self._filename][techno+&#39;_index&#39;]</span>

<span class="sd">            if offset &gt;0</span>
<span class="sd">                add np.nan at the begining</span>
<span class="sd">            if offset &lt;0</span>
<span class="sd">                first values of self.hkb will be dropped</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span>
        <span class="k">elif</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span>
        <span class="k">elif</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;BS&#39;</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Unknown tecnology got applying offset&#39;</span><span class="p">)</span>


        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">][</span><span class="n">techno</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;_index&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">offset</span><span class="p">:]</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">offset</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c1">#extract time values</span>
            <span class="n">npahkbi</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">npahkbi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">npahkbi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nstart</span> <span class="o">=</span> <span class="n">npahkbi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="p">(</span><span class="n">step</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span><span class="p">))</span>
            <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">npahkbi</span> <span class="o">+</span> <span class="n">nstart</span><span class="p">)</span>

            <span class="c1">#add blank at begining</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({},</span><span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">index</span><span class="o">=</span><span class="n">npahkbi</span><span class="p">[:</span><span class="n">offset</span><span class="p">])</span>
            <span class="n">ndf</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">df</span><span class="p">])</span>
            <span class="n">df</span><span class="o">=</span><span class="n">ndf</span>
        <span class="k">if</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thkb</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
        <span class="k">elif</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ttcr</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
        <span class="k">elif</span> <span class="n">techno</span> <span class="o">==</span> <span class="s1">&#39;BS&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tbs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span></div>


    <span class="k">def</span> <span class="nf">_apply_hkb_offset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; apply offset from self.offset[self._filename][&#39;hkb_index&#39;]</span>

<span class="sd">            if offset &gt;0</span>
<span class="sd">                add np.nan at the begining</span>
<span class="sd">            if offset &lt;0</span>
<span class="sd">                first values of self.hkb will be dropped</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="c1"># offset = self.offset[self._filename][&#39;hkb_index&#39;]</span>
        <span class="c1"># if offset &gt;=0:</span>
        <span class="c1">#     self.hkb = self.hkb.iloc[offset:]</span>
        <span class="c1"># else :</span>
        <span class="c1">#     # new length</span>
        <span class="c1">#     lhkb = len(self.hkb) + (-offset)</span>
        <span class="c1">#     #extract time values</span>
        <span class="c1">#     npahkbi = self.hkb.index.values</span>
        <span class="c1">#     #calculate new termianl time</span>
        <span class="c1">#     step = npahkbi[1]- npahkbi[0]</span>
        <span class="c1">#     nstop = npahkbi[-1]+ (step * (-offset))</span>
        <span class="c1">#     ni = np.linspace(0,nstop,lhkb)</span>
        <span class="c1">#     df = pd.DataFrame({},columns=self.hkb.keys(),index=ni[0:-offset])</span>

        <span class="c1">#     self.hkb.index=pd.Index(ni[-offset:])</span>
        <span class="c1">#     ndf=pd.concat([df,self.hkb])</span>

        <span class="c1">#     self.hkb=ndf</span>

        <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_filename</span><span class="p">][</span><span class="s1">&#39;hkb_index&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">offset</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">:</span>
            <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="n">offset</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">offset</span><span class="p">]</span>
        <span class="k">else</span> <span class="p">:</span>
            <span class="c1">#extract time values</span>
            <span class="n">npahkbi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">npahkbi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span> <span class="n">npahkbi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">nstart</span> <span class="o">=</span> <span class="n">npahkbi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="p">(</span><span class="n">step</span> <span class="o">*</span> <span class="p">(</span><span class="n">offset</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">npahkbi</span> <span class="o">+</span> <span class="n">nstart</span><span class="p">)</span>

            <span class="c1">#add blank at begining</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({},</span><span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="n">index</span><span class="o">=</span><span class="n">npahkbi</span><span class="p">[:</span><span class="n">offset</span><span class="p">])</span>
            <span class="n">ndf</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">=</span><span class="n">ndf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thkb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span><span class="o">.</span><span class="n">index</span>

<div class="viewcode-block" id="CorSer._align_on_devdf"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._align_on_devdf.html#pylayers.measures.cormoran.CorSer._align_on_devdf">[docs]</a>    <span class="k">def</span> <span class="nf">_align_on_devdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">typ</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; align hkb or bs time on device data frame (devdf) time index</span>

<span class="sd">        In place (a.k.a. replace old self.hkb by the resampled one)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        typp : &#39;HKB&#39; |&#39;BS&#39;</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S = CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; devdf = S.devdf[S.devdf[&#39;id&#39;]==&#39;HKB:15&#39;]</span>
<span class="sd">        &gt;&gt;&gt; hkbdf = S.hkb[&#39;AP1-AnkleLeft&#39;]</span>
<span class="sd">        &gt;&gt;&gt; devdf2 = S._align_on_hkb(devdf,hkbdf,typ =&#39;HKB&#39;)</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">:</span>
            <span class="n">idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;BS&#39;</span><span class="p">:</span>
            <span class="n">idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
            <span class="n">idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span>

        <span class="c1"># mocap time</span>
        <span class="c1">#</span>
        <span class="c1"># 0 0.010001 0.020002</span>
        <span class="n">mocapindex</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmocap</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="c1"># radio time</span>
        <span class="c1"># 0  0.023  0.0473</span>
        <span class="n">idf</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idf</span><span class="o">.</span><span class="n">index</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>


        <span class="n">sf</span> <span class="o">=</span> <span class="p">(</span><span class="n">mocapindex</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">mocapindex</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">microseconds</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">idf</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">fill_method</span><span class="o">=</span><span class="s1">&#39;ffill&#39;</span><span class="p">)</span>

        <span class="n">nindex</span> <span class="o">=</span> <span class="n">time2npa</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">nindex</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;HKB&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hkb</span> <span class="o">=</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;BS&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bespo</span> <span class="o">=</span> <span class="n">df</span>
        <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s1">&#39;TCR&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tcr</span> <span class="o">=</span> <span class="n">df</span></div>

<div class="viewcode-block" id="CorSer._align_devdf_on_hkb"><a class="viewcode-back" href="../../../modules/generated/pylayers.measures.cormoran.CorSer._align_devdf_on_hkb.html#pylayers.measures.cormoran.CorSer._align_devdf_on_hkb">[docs]</a>    <span class="k">def</span> <span class="nf">_align_devdf_on_hkb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">devdf</span><span class="p">,</span><span class="n">hkbdf</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; NOT USED Practically</span>
<span class="sd">            align time of 2 data frames:</span>

<span class="sd">        the time delta of the second data frame is applyied on the first one</span>
<span class="sd">        (e.g. time for devdf donwsampled by hkb data frame time)</span>


<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        devdf : device dataframe</span>
<span class="sd">        hkbdf : hkbdataframe</span>

<span class="sd">        Return</span>
<span class="sd">        ------</span>

<span class="sd">        devdfc : </span>
<span class="sd">            aligned copy device dataframe</span>
<span class="sd">        hkbdfc : </span>
<span class="sd">            aligned copy hkbdataframe</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        &gt;&gt;&gt; from pylayers.measures.cormoran import *</span>
<span class="sd">        &gt;&gt;&gt; S=CorSer(6)</span>
<span class="sd">        &gt;&gt;&gt; devdf = S.devdf[S.devdf[&#39;id&#39;]==&#39;HKB:15&#39;]</span>
<span class="sd">        &gt;&gt;&gt; hkbdf = S.hkb[&#39;AP1-AnkleLeft&#39;]</span>
<span class="sd">        &gt;&gt;&gt; devdf2 = S._align_devdf_on_hkb(devdf,hkbdf)</span>


<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">devdfc</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">devdf</span><span class="p">)</span>

        <span class="n">hkbdfc</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">hkbdf</span><span class="p">)</span>

        <span class="n">idev</span> <span class="o">=</span> <span class="n">devdfc</span><span class="o">.</span><span class="n">index</span>
        <span class="n">ihkb</span> <span class="o">=</span> <span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span>

        <span class="n">devdfc</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">idev</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ihkb</span><span class="p">,</span><span class="n">unit</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
        <span class="n">sf</span> <span class="o">=</span> <span class="p">(</span><span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">hkbdfc</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">microseconds</span>

        <span class="c1"># cannot resapmple devdf directly because multiple similar index values</span>
        <span class="c1">#need to resampl each groupby separately</span>
        <span class="n">gb</span> <span class="o">=</span> <span class="n">devdfc</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
        <span class="c1">#get device id </span>
        <span class="n">devid</span><span class="p">,</span><span class="n">idevid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">devdfc</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span><span class="n">return_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="c1">#save corresponding subject to each device</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="p">{</span><span class="n">devid</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">devdfc</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idevid</span><span class="p">}</span>
        <span class="c1"># resample each group separatley</span>
        <span class="n">dgb</span><span class="o">=</span><span class="p">{</span><span class="n">d</span><span class="p">:</span><span class="n">gb</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sf</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;U&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devid</span><span class="p">}</span>
        <span class="c1">#re insert subject and device id information in each resampled group</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dgb</span><span class="p">:</span>
            <span class="n">dgb</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">subject</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="n">dgb</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span>

        <span class="c1"># create the realigned Dataframe</span>

        <span class="n">lgb</span> <span class="o">=</span> <span class="p">[</span><span class="n">dgb</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dgb</span><span class="p">]</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">lgb</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">nindex</span> <span class="o">=</span> <span class="n">time2npa</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">nindex</span><span class="p">)</span>
        <span class="n">cols</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span><span class="s1">&#39;subject&#39;</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;vx&#39;</span><span class="p">,</span><span class="s1">&#39;vy&#39;</span><span class="p">,</span><span class="s1">&#39;vz&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="s1">&#39;az&#39;</span><span class="p">]</span>
        <span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">df</span></div>

<span class="k">def</span> <span class="nf">dist_sh2rssi</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span><span class="n">Ssh</span><span class="p">,</span><span class="n">offsetdB</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    dist</span>
<span class="sd">    Ssh </span>
<span class="sd">    offsetdB : float</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dist</span><span class="p">)</span><span class="o">==</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">values</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="n">dist</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Ssh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">z1</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">z1</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">-</span><span class="n">offsetdB</span>
    <span class="n">z1</span> <span class="o">=</span> <span class="n">z1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>
    <span class="k">return</span><span class="p">(</span><span class="n">z1</span><span class="p">)</span>

<span class="c1">#    z2 = Srssi.values</span>
<span class="c1">#    z2m = np.mean(z2[~np.isnan(z2)])</span>
<span class="c1">#    z2[np.isnan(z2)]=z2m</span>
<span class="c1">#    z2 = z2-np.mean(z2)</span>
<span class="c1">#    z1n = z1/np.sqrt(np.sum(z1*z1))</span>
<span class="c1">#    z2n = z2/np.sqrt(np.sum(z2*z2))</span>
<span class="c1">#    cn,dec,ratio = resync(z1n,z2n)</span>
<span class="c1">#    tdec.append(dec)</span>

<span class="c1">#tratio.append(ratio)</span>
<span class="c1">#if ratio &gt; maxratio:</span>
<span class="c1">#    maxratio =  ratio</span>

    <span class="c1"># def get_data(self,a,b):</span>


    <span class="c1">#     T=self.tcr[a+&#39;-&#39;+b]</span>
    <span class="c1">#     T.name=T.name+&#39;-tcr&#39;</span>
    <span class="c1">#     H=self.hkb[a+&#39;-&#39;+b]</span>
    <span class="c1">#     H.name=H.name+&#39;-hkb&#39;</span>
    <span class="c1">#     udhk = self.accessdm(a,b,&#39;HKB&#39;)</span>
    <span class="c1">#     udtcr = self.accessdm(a,b,&#39;HKB&#39;)</span>
    <span class="c1">#     dist_tcr=self.dist[:,udtcr[0],udtcr[1]]</span>
    <span class="c1">#     dist_hkb=self.dist[:,udhk[0],udhk[1]]</span>
    <span class="c1">#     tdist=np.linspace(0,self.dist.shape[0]/100.,self.dist.shape[0])</span>
    <span class="c1">#     D_tcr=pd.Series(dist_tcr,index=tdist)</span>
    <span class="c1">#     D_tcr.name = &#39;dist-tcr&#39;</span>
    <span class="c1">#     D_hkb=pd.Series(dist_hkb,index=tdist)</span>
    <span class="c1">#     D_hkb.name = &#39;dist-hkb&#39;</span>

    <span class="c1">#     return T,H,D_tcr,D_hkb</span>


    <span class="c1"># def get_dataframes(self,a,b):</span>
    <span class="c1">#     &quot;&quot;&quot; assemble all series in a DataFrame</span>
    <span class="c1">#     &quot;&quot;&quot;</span>

    <span class="c1">#     T,H,DT,DH = self.get_data(a,b)</span>
    <span class="c1">#     NH=(np.sqrt(1/(10**(H/10)))/4e4)</span>
    <span class="c1">#     NHc=NH-NH.mean()</span>
    <span class="c1">#     DHc=DH-DH.mean()</span>
    <span class="c1">#     inh = NHc.index</span>
    <span class="c1">#     idh = DHc.index</span>
    <span class="c1">#     NHc.index = pd.to_datetime(inh,unit=&#39;m&#39;)</span>
    <span class="c1">#     DHc.index = pd.to_datetime(idh,unit=&#39;m&#39;)</span>
    <span class="c1">#     sD = (DHc.index[1]-DHc.index[0])</span>
    <span class="c1">#     sf= str(int(sD.microseconds*1e-3)) + &#39;ms&#39;</span>
    <span class="c1">#     NHcr = NHc.resample(sf,fill_method=&#39;ffill&#39;)</span>
    <span class="c1">#     return NHcr,DHc</span>
</pre></div>

          </div>
        </div>
      </div>
        <div class="clearer"></div>
      </div>
    </div>
  

    <div class="footer">
        &copy; 2015, PyLayers developer team.
      Last updated on avril 08, 2016.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.3.5. Design by <a href="http://desgrana.es">Desgrana</a>.
    </div>
     <div class="rel">
    
    <div class="buttonPrevious">
      <a href="../../../py-modindex.html">
        Previous
      </a>  
    </div>
    
     </div>
     <script type="text/javascript">
       $("div.buttonNext, div.buttonPrevious").hover(
           function () {
               $(this).css('background-color', '#AFFFFF');
           },
           function () {
               $(this).css('background-color', '#AFFFFF');
           }
       );
     </script>
  </body>
</html>